<!-- saved from url=(0014)about:internet -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>URI.as</title>
<link rel="stylesheet" type="text/css" href="../../../../SourceStyles.css"/>
</head>

<body><pre><span class="ActionScriptComment">/*
  Copyright (c) 2008, Adobe Systems Incorporated
  All rights reserved.

  Redistribution and use in source and binary forms, with or without 
  modification, are permitted provided that the following conditions are
  met:

  * Redistributions of source code must retain the above copyright notice, 
    this list of conditions and the following disclaimer.
  
  * Redistributions in binary form must reproduce the above copyright
    notice, this list of conditions and the following disclaimer in the 
    documentation and/or other materials provided with the distribution.
  
  * Neither the name of Adobe Systems Incorporated nor the names of its 
    contributors may be used to endorse or promote products derived from 
    this software without specific prior written permission.

  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS
  IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
  THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
  PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR 
  CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
  PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/</span>

<span class="ActionScriptpackage">package</span> <span class="ActionScriptDefault_Text">com</span>.<span class="ActionScriptDefault_Text">adobe</span>.<span class="ActionScriptDefault_Text">net</span>
<span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span>.<span class="ActionScriptDefault_Text">utils</span>.<span class="ActionScriptDefault_Text">ByteArray</span>;
    
    <span class="ActionScriptASDoc">/**
     * This class implements functions and utilities for working with URI&apos;s
     * (Universal Resource Identifiers).  For technical description of the
     * URI syntax, please see RFC 3986 at http://www.ietf.org/rfc/rfc3986.txt
     * or do a web search for &quot;rfc 3986&quot;.
     * 
     * &lt;p&gt;The most important aspect of URI&apos;s to understand is that URI&apos;s
     * and URL&apos;s are not strings.  URI&apos;s are complex data structures that
     * encapsulate many pieces of information.  The string version of a
     * URI is the serialized representation of that data structure.  This
     * string serialization is used to provide a human readable
     * representation and a means to transport the data over the network
     * where it can then be parsed back into its&apos; component parts.&lt;/p&gt;
     * 
     * &lt;p&gt;URI&apos;s fall into one of three categories:
     * &lt;ul&gt;
     *  &lt;li&gt;&amp;lt;scheme&amp;gt;:&amp;lt;scheme-specific-part&amp;gt;#&amp;lt;fragment&amp;gt;        (non-hierarchical)&lt;/li&gt;
     *  &lt;li&gt;&amp;lt;scheme&amp;gt;:&lt;authority&amp;gt;&amp;lt;path&amp;gt;?&amp;lt;query&amp;gt;#&amp;lt;fragment&amp;gt;    (hierarchical)&lt;/li&gt;
     *  &lt;li&gt;&amp;lt;path&amp;gt;?&amp;lt;query&amp;gt;#&amp;lt;fragment&amp;gt;                        (relative hierarchical)&lt;/li&gt;
     * &lt;/ul&gt;&lt;/p&gt;
     * 
     * &lt;p&gt;The query and fragment parts are optional.&lt;/p&gt;
     * 
     * &lt;p&gt;This class supports both non-hierarchical and hierarchical URI&apos;s&lt;/p&gt;
     * 
     * &lt;p&gt;This class is intended to be used &quot;as-is&quot; for the vast majority
     * of common URI&apos;s.  However, if your application requires a custom
     * URI syntax (e.g. custom query syntax or special handling of
     * non-hierarchical URI&apos;s), this class can be fully subclassed.  If you
     * intended to subclass URI, please see the source code for complete
     * documation on protected members and protected fuctions.&lt;/p&gt;
     * 
     * @langversion ActionScript 3.0
     * @playerversion Flash 9.0 
     */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptclass">class</span> <span class="ActionScriptDefault_Text">URI</span>
    <span class="ActionScriptBracket/Brace">{</span>    
        <span class="ActionScriptComment">// Here we define which characters must be escaped for each
</span>        <span class="ActionScriptComment">// URI part.  The characters that must be escaped for each
</span>        <span class="ActionScriptComment">// part differ depending on what would cause ambiguous parsing.
</span>        <span class="ActionScriptComment">// RFC 3986 sec. 2.4 states that characters should only be
</span>        <span class="ActionScriptComment">// encoded when they would conflict with subcomponent delimiters.
</span>        <span class="ActionScriptComment">// We don&apos;t want to over-do the escaping.  We only want to escape
</span>        <span class="ActionScriptComment">// the minimum needed to prevent parsing problems.
</span>        
        <span class="ActionScriptComment">// space and % must be escaped in all cases.  &apos;%&apos; is the delimiter
</span>        <span class="ActionScriptComment">// for escaped characters.
</span>        <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">URImustEscape</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span>    <span class="ActionScriptString">&quot; %&quot;</span>;
        
        <span class="ActionScriptComment">// Baseline of what characters must be escaped
</span>        <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">URIbaselineEscape</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">URImustEscape</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">&quot;:?#/@&quot;</span>;
        
        <span class="ActionScriptComment">// Characters that must be escaped in the part part.
</span>        <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">URIpathEscape</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">URImustEscape</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">&quot;?#&quot;</span>;
        
        <span class="ActionScriptComment">// Characters that must be escaped in the query part, if setting
</span>        <span class="ActionScriptComment">// the query as a whole string.  If the query is set by
</span>        <span class="ActionScriptComment">// name/value, URIqueryPartEscape is used instead.
</span>        <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">URIqueryEscape</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">URImustEscape</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">&quot;#&quot;</span>;
        
        <span class="ActionScriptComment">// This is what each name/value pair must escape &quot;&amp;=&quot; as well
</span>        <span class="ActionScriptComment">// so they don&apos;t conflict with the &quot;param=value&amp;param2=value2&quot;
</span>        <span class="ActionScriptComment">// syntax.
</span>        <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">URIqueryPartEscape</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">URImustEscape</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">&quot;#&amp;=&quot;</span>;
        
        <span class="ActionScriptComment">// Non-hierarchical URI&apos;s can have query and fragment parts, but
</span>        <span class="ActionScriptComment">// we also want to prevent &apos;/&apos; otherwise it might end up looking
</span>        <span class="ActionScriptComment">// like a hierarchical URI to the parser.
</span>        <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">URInonHierEscape</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span>     <span class="ActionScriptDefault_Text">URImustEscape</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">&quot;?#/&quot;</span>;
        
        <span class="ActionScriptComment">// Baseline uninitialized setting for the URI scheme.
</span>        <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">UNKNOWN_SCHEME</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;unknown&quot;</span>;
        
        <span class="ActionScriptComment">// The following bitmaps are used for performance enhanced
</span>        <span class="ActionScriptComment">// character escaping.
</span>        
        <span class="ActionScriptComment">// Baseline characters that need to be escaped.  Many parts use
</span>        <span class="ActionScriptComment">// this.
</span>        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">URIbaselineExcludedBitmap</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">URIEncodingBitmap</span> <span class="ActionScriptOperator">=</span>
            <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">URIEncodingBitmap</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">URIbaselineEscape</span><span class="ActionScriptBracket/Brace">)</span>;
        
        <span class="ActionScriptComment">// Scheme escaping bitmap
</span>        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">URIschemeExcludedBitmap</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">URIEncodingBitmap</span> <span class="ActionScriptOperator">=</span> 
            <span class="ActionScriptDefault_Text">URIbaselineExcludedBitmap</span>;
        
        <span class="ActionScriptComment">// User/pass escaping bitmap
</span>        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">URIuserpassExcludedBitmap</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">URIEncodingBitmap</span> <span class="ActionScriptOperator">=</span>
            <span class="ActionScriptDefault_Text">URIbaselineExcludedBitmap</span>;
        
        <span class="ActionScriptComment">// Authority escaping bitmap
</span>        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">URIauthorityExcludedBitmap</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">URIEncodingBitmap</span> <span class="ActionScriptOperator">=</span>
            <span class="ActionScriptDefault_Text">URIbaselineExcludedBitmap</span>;
            
        <span class="ActionScriptComment">// Port escaping bitmap
</span>        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">URIportExludedBitmap</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">URIEncodingBitmap</span> <span class="ActionScriptOperator">=</span> 
            <span class="ActionScriptDefault_Text">URIbaselineExcludedBitmap</span>;
        
        <span class="ActionScriptComment">// Path escaping bitmap
</span>        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">URIpathExcludedBitmap</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">URIEncodingBitmap</span> <span class="ActionScriptOperator">=</span>
             <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">URIEncodingBitmap</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">URIpathEscape</span><span class="ActionScriptBracket/Brace">)</span>;
            
        <span class="ActionScriptComment">// Query (whole) escaping bitmap
</span>        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">URIqueryExcludedBitmap</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">URIEncodingBitmap</span> <span class="ActionScriptOperator">=</span>
            <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">URIEncodingBitmap</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">URIqueryEscape</span><span class="ActionScriptBracket/Brace">)</span>;
            
        <span class="ActionScriptComment">// Query (individual parts) escaping bitmap
</span>        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">URIqueryPartExcludedBitmap</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">URIEncodingBitmap</span> <span class="ActionScriptOperator">=</span>
            <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">URIEncodingBitmap</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">URIqueryPartEscape</span><span class="ActionScriptBracket/Brace">)</span>;
            
        <span class="ActionScriptComment">// Fragments are the last part in the URI.  They only need to
</span>        <span class="ActionScriptComment">// escape space, &apos;#&apos;, and &apos;%&apos;.  Turns out that is what query
</span>        <span class="ActionScriptComment">// uses too.
</span>        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">URIfragmentExcludedBitmap</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">URIEncodingBitmap</span> <span class="ActionScriptOperator">=</span>
            <span class="ActionScriptDefault_Text">URIqueryExcludedBitmap</span>;
            
        <span class="ActionScriptComment">// Characters that need to be escaped in the non-hierarchical part
</span>        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">URInonHierexcludedBitmap</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">URIEncodingBitmap</span> <span class="ActionScriptOperator">=</span>
            <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">URIEncodingBitmap</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">URInonHierEscape</span><span class="ActionScriptBracket/Brace">)</span>;
            
        <span class="ActionScriptComment">// Values used by getRelation()
</span>        <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">NOT_RELATED</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0;
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">CHILD</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 1;
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">EQUAL</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 2;
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">PARENT</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 3;

        <span class="ActionScriptComment">//-------------------------------------------------------------------
</span>        <span class="ActionScriptComment">// protected class members
</span>        <span class="ActionScriptComment">//-------------------------------------------------------------------
</span>        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_valid</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_relative</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_scheme</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;&quot;</span>;
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_authority</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;&quot;</span>;
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_username</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;&quot;</span>;
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_password</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;&quot;</span>;
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_port</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;&quot;</span>;
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_path</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;&quot;</span>;
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_query</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;&quot;</span>;
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_fragment</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;&quot;</span>;
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_nonHierarchical</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;&quot;</span>;
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_resolver</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IURIResolver</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;


        <span class="ActionScriptASDoc">/**
         *  URI Constructor.  If no string is given, this will initialize
         *  this URI object to a blank URI.
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">URI</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">uri</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptReserved">void</span>    
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">uri</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">initialize</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptReserved">else</span>
                <span class="ActionScriptDefault_Text">constructURI</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">uri</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        
        <span class="ActionScriptASDoc">/**
         * @private
         * Method that loads the URI from the given string.
         */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">constructURI</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">uri</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">Boolean</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(!</span><span class="ActionScriptDefault_Text">parseURI</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">uri</span><span class="ActionScriptBracket/Brace">))</span>
                <span class="ActionScriptDefault_Text">_valid</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
                
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">isValid</span><span class="ActionScriptBracket/Brace">()</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        
        <span class="ActionScriptASDoc">/**
         * @private Private initializiation.
         */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">initialize</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">_valid</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
            <span class="ActionScriptDefault_Text">_relative</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
        
            <span class="ActionScriptDefault_Text">_scheme</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">UNKNOWN_SCHEME</span>;
            <span class="ActionScriptDefault_Text">_authority</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;&quot;</span>;
            <span class="ActionScriptDefault_Text">_username</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;&quot;</span>;
            <span class="ActionScriptDefault_Text">_password</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;&quot;</span>;
            <span class="ActionScriptDefault_Text">_port</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;&quot;</span>;
            <span class="ActionScriptDefault_Text">_path</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;&quot;</span>;
            <span class="ActionScriptDefault_Text">_query</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;&quot;</span>;
            <span class="ActionScriptDefault_Text">_fragment</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;&quot;</span>;
        
            <span class="ActionScriptDefault_Text">_nonHierarchical</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;&quot;</span>;
        <span class="ActionScriptBracket/Brace">}</span>    
        
        <span class="ActionScriptASDoc">/**
         * @private Accessor to explicitly set/get the hierarchical
         * state of the URI.
         */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">hierState</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">state</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">state</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// Clear the non-hierarchical data
</span>                <span class="ActionScriptDefault_Text">_nonHierarchical</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;&quot;</span>;
        
                <span class="ActionScriptComment">// Also set the state vars while we are at it
</span>                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_scheme</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&quot;&quot;</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">_scheme</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">UNKNOWN_SCHEME</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptDefault_Text">_relative</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
                <span class="ActionScriptReserved">else</span>
                    <span class="ActionScriptDefault_Text">_relative</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
        
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_authority</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">==</span> 0 <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">_path</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">==</span> 0<span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptDefault_Text">_valid</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
                <span class="ActionScriptReserved">else</span>
                    <span class="ActionScriptDefault_Text">_valid</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// Clear the hierarchical data
</span>                <span class="ActionScriptDefault_Text">_authority</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;&quot;</span>;
                <span class="ActionScriptDefault_Text">_username</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;&quot;</span>;
                <span class="ActionScriptDefault_Text">_password</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;&quot;</span>;
                <span class="ActionScriptDefault_Text">_port</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;&quot;</span>;
                <span class="ActionScriptDefault_Text">_path</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;&quot;</span>;
        
                <span class="ActionScriptDefault_Text">_relative</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
        
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_scheme</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&quot;&quot;</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">_scheme</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">UNKNOWN_SCHEME</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptDefault_Text">_valid</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
                <span class="ActionScriptReserved">else</span>
                    <span class="ActionScriptDefault_Text">_valid</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">hierState</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">Boolean</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_nonHierarchical</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">==</span> 0<span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        
        <span class="ActionScriptASDoc">/**
         * @private Functions that performs some basic consistency validation.
         */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">validateURI</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">Boolean</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptComment">// Check the scheme
</span>            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">isAbsolute</span><span class="ActionScriptBracket/Brace">())</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_scheme</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">&lt;=</span> 1 <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">_scheme</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">UNKNOWN_SCHEME</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptComment">// we probably parsed a C:\ type path or no scheme
</span>                    <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">false</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">verifyAlpha</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_scheme</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">false</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">false</span>;  <span class="ActionScriptComment">// Scheme contains bad characters
</span>            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">hierState</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_path</span>.<span class="ActionScriptDefault_Text">search</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;\\&apos;</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">false</span>;  <span class="ActionScriptComment">// local path
</span>                <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">isRelative</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">false</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">_scheme</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">UNKNOWN_SCHEME</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">false</span>;  <span class="ActionScriptComment">// It&apos;s an absolute URI, but it has a bad scheme
</span>            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_nonHierarchical</span>.<span class="ActionScriptDefault_Text">search</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;\\&apos;</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">false</span>;  <span class="ActionScriptComment">// some kind of local path
</span>            <span class="ActionScriptBracket/Brace">}</span>
        
            <span class="ActionScriptComment">// Looks like it&apos;s ok.
</span>            <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">true</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        
        <span class="ActionScriptASDoc">/**
         * @private
         *
         * Given a URI in string format, parse that sucker into its basic
         * components and assign them to this object.  A URI is of the form:
         *    &lt;scheme&gt;:&lt;authority&gt;&lt;path&gt;?&lt;query&gt;#&lt;fragment&gt;
         *
         * For simplicity, we parse the URI in the following order:
         *         
         *        1. Fragment (anchors)
         *         2. Query    (CGI stuff)
         *         3. Scheme    (&quot;http&quot;)
         *         4. Authority (host name)
         *         5. Username/Password (if any)
         *         6. Port        (server port if any)
         *        7. Path        (/homepages/mypage.html)
         *
         * The reason for this order is to minimize any parsing ambiguities.
         * Fragments and queries can contain almost anything (they are parts
         * that can contain custom data with their own syntax).  Parsing
         * them out first removes a large chance of parsing errors.  This
         * method expects well formed URI&apos;s, but performing the parse in
         * this order makes us a little more tolerant of user error.
         * 
         * REGEXP
         * Why doesn&apos;t this use regular expressions to parse the URI?  We
         * have found that in a real world scenario, URI&apos;s are not always
         * well formed.  Sometimes characters that should have been escaped
         * are not, and those situations would break a regexp pattern.  This
         * function attempts to be smart about what it is parsing based on
         * location of characters relative to eachother.  This function has
         * been proven through real-world use to parse the vast majority
         * of URI&apos;s correctly.
         *
         * NOTE
         * It is assumed that the string in URI form is escaped.  This function
         * does not escape anything.  If you constructed the URI string by
         * hand, and used this to parse in the URI and still need it escaped,
         * call forceEscape() on your URI object.
         *
         * Parsing Assumptions
         * This routine assumes that the URI being passed is well formed.
         * Passing things like local paths, malformed URI&apos;s, and the such
         * will result in parsing errors.  This function can handle
         *      - absolute hierarchical (e.g. &quot;http://something.com/index.html),
         *   - relative hierarchical (e.g. &quot;../images/flower.gif&quot;), or
         *   - non-hierarchical URIs (e.g. &quot;mailto:jsmith@fungoo.com&quot;).
         * 
         * Anything else will probably result in a parsing error, or a bogus
         * URI object.
         * 
         * Note that non-hierarchical URIs *MUST* have a scheme, otherwise
         * they will be mistaken for relative URI&apos;s.
         * 
         * If you are not sure what is being passed to you (like manually
         * entered text from UI), you can construct a blank URI object and
         * call unknownToURI() passing in the unknown string.
         * 
         * @return    true if successful, false if there was some kind of
         * parsing error
         */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">parseURI</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">uri</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">Boolean</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">baseURI</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">uri</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">index</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>, <span class="ActionScriptDefault_Text">index2</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;
        
            <span class="ActionScriptComment">// Make sure this object is clean before we start.  If it was used
</span>            <span class="ActionScriptComment">// before and we are now parsing a new URI, we don&apos;t want any stale
</span>            <span class="ActionScriptComment">// info lying around.
</span>            <span class="ActionScriptDefault_Text">initialize</span><span class="ActionScriptBracket/Brace">()</span>;
        
            <span class="ActionScriptComment">// Remove any fragments (anchors) from the URI
</span>            <span class="ActionScriptDefault_Text">index</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">baseURI</span>.<span class="ActionScriptDefault_Text">indexOf</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;#&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">index</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// Store the fragment piece if any
</span>                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">baseURI</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">&gt;</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">index</span> <span class="ActionScriptOperator">+</span> 1<span class="ActionScriptBracket/Brace">))</span> <span class="ActionScriptComment">// +1 is to skip the &apos;#&apos;
</span>                    <span class="ActionScriptDefault_Text">_fragment</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">baseURI</span>.<span class="ActionScriptDefault_Text">substr</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">index</span> <span class="ActionScriptOperator">+</span> 1, <span class="ActionScriptDefault_Text">baseURI</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">index</span> <span class="ActionScriptOperator">+</span> 1<span class="ActionScriptBracket/Brace">))</span>; 
        
                <span class="ActionScriptComment">// Trim off the fragment
</span>                <span class="ActionScriptDefault_Text">baseURI</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">baseURI</span>.<span class="ActionScriptDefault_Text">substr</span><span class="ActionScriptBracket/Brace">(</span>0, <span class="ActionScriptDefault_Text">index</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        
            <span class="ActionScriptComment">// We need to strip off any CGI parameters (eg &apos;?param=bob&apos;)
</span>            <span class="ActionScriptDefault_Text">index</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">baseURI</span>.<span class="ActionScriptDefault_Text">indexOf</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;?&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">index</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">baseURI</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">&gt;</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">index</span> <span class="ActionScriptOperator">+</span> 1<span class="ActionScriptBracket/Brace">))</span>
                    <span class="ActionScriptDefault_Text">_query</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">baseURI</span>.<span class="ActionScriptDefault_Text">substr</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">index</span> <span class="ActionScriptOperator">+</span> 1, <span class="ActionScriptDefault_Text">baseURI</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">index</span> <span class="ActionScriptOperator">+</span> 1<span class="ActionScriptBracket/Brace">))</span>; <span class="ActionScriptComment">// +1 is to skip the &apos;?&apos;
</span>        
                <span class="ActionScriptComment">// Trim off the query
</span>                <span class="ActionScriptDefault_Text">baseURI</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">baseURI</span>.<span class="ActionScriptDefault_Text">substr</span><span class="ActionScriptBracket/Brace">(</span>0, <span class="ActionScriptDefault_Text">index</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        
            <span class="ActionScriptComment">// Now try to find the scheme part
</span>            <span class="ActionScriptDefault_Text">index</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">baseURI</span>.<span class="ActionScriptDefault_Text">search</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;:&apos;</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">index2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">baseURI</span>.<span class="ActionScriptDefault_Text">search</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;/&apos;</span><span class="ActionScriptBracket/Brace">)</span>;
        
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">containsColon</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">index</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">containsSlash</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">index2</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">)</span>;
        
            <span class="ActionScriptComment">// This value is indeterminate if &quot;containsColon&quot; is false.
</span>            <span class="ActionScriptComment">// (if there is no colon, does the slash come before or
</span>            <span class="ActionScriptComment">// after said non-existing colon?)
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">colonBeforeSlash</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(!</span><span class="ActionScriptDefault_Text">containsSlash</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">index</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">index2</span><span class="ActionScriptBracket/Brace">)</span>;
        
            <span class="ActionScriptComment">// If it has a colon and it&apos;s before the first slash, we will treat
</span>            <span class="ActionScriptComment">// it as a scheme.  If a slash is before a colon, there must be a
</span>            <span class="ActionScriptComment">// stray colon in a path or something.  In which case, the colon is
</span>            <span class="ActionScriptComment">// not the separator for the scheme.  Technically, we could consider
</span>            <span class="ActionScriptComment">// this an error, but since this is not an ambiguous state (we know
</span>            <span class="ActionScriptComment">// 100% that this has no scheme), we will keep going.
</span>            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">containsColon</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">colonBeforeSlash</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// We found a scheme
</span>                <span class="ActionScriptDefault_Text">_scheme</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">baseURI</span>.<span class="ActionScriptDefault_Text">substr</span><span class="ActionScriptBracket/Brace">(</span>0, <span class="ActionScriptDefault_Text">index</span><span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptComment">// Normalize the scheme
</span>                <span class="ActionScriptDefault_Text">_scheme</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_scheme</span>.<span class="ActionScriptDefault_Text">toLowerCase</span><span class="ActionScriptBracket/Brace">()</span>;
        
                <span class="ActionScriptDefault_Text">baseURI</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">baseURI</span>.<span class="ActionScriptDefault_Text">substr</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">index</span> <span class="ActionScriptOperator">+</span> 1<span class="ActionScriptBracket/Brace">)</span>;
        
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">baseURI</span>.<span class="ActionScriptDefault_Text">substr</span><span class="ActionScriptBracket/Brace">(</span>0, 2<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&quot;//&quot;</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptComment">// This is a hierarchical URI
</span>                    <span class="ActionScriptDefault_Text">_nonHierarchical</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;&quot;</span>;
        
                    <span class="ActionScriptComment">// Trim off the &quot;//&quot;
</span>                    <span class="ActionScriptDefault_Text">baseURI</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">baseURI</span>.<span class="ActionScriptDefault_Text">substr</span><span class="ActionScriptBracket/Brace">(</span>2, <span class="ActionScriptDefault_Text">baseURI</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">-</span> 2<span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">else</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptComment">// This is a non-hierarchical URI like &quot;mailto:bob@mail.com&quot;
</span>                    <span class="ActionScriptDefault_Text">_nonHierarchical</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">baseURI</span>;
        
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">((</span><span class="ActionScriptDefault_Text">_valid</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">validateURI</span><span class="ActionScriptBracket/Brace">())</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">false</span><span class="ActionScriptBracket/Brace">)</span>
                        <span class="ActionScriptDefault_Text">initialize</span><span class="ActionScriptBracket/Brace">()</span>;  <span class="ActionScriptComment">// Bad URI.  Clear it.
</span>        
                    <span class="ActionScriptComment">// No more parsing to do for this case
</span>                    <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">isValid</span><span class="ActionScriptBracket/Brace">()</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// No scheme.  We will consider this a relative URI
</span>                <span class="ActionScriptDefault_Text">_scheme</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;&quot;</span>;
                <span class="ActionScriptDefault_Text">_relative</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
                <span class="ActionScriptDefault_Text">_nonHierarchical</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;&quot;</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        
            <span class="ActionScriptComment">// Ok, what we have left is everything after the &lt;scheme&gt;://
</span>        
            <span class="ActionScriptComment">// Now that we have stripped off any query and fragment parts, we
</span>            <span class="ActionScriptComment">// need to split the authority from the path
</span>        
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">isRelative</span><span class="ActionScriptBracket/Brace">())</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// Don&apos;t bother looking for the authority.  It&apos;s a relative URI
</span>                <span class="ActionScriptDefault_Text">_authority</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;&quot;</span>;
                <span class="ActionScriptDefault_Text">_port</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;&quot;</span>;
                <span class="ActionScriptDefault_Text">_path</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">baseURI</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// Check for malformed UNC style file://///server/type/path/
</span>                <span class="ActionScriptComment">// By the time we get here, we have already trimmed the &quot;file://&quot;
</span>                <span class="ActionScriptComment">// so baseURI will be ///server/type/path.  If baseURI only
</span>                <span class="ActionScriptComment">// has one slash, we leave it alone because that is valid (that
</span>                <span class="ActionScriptComment">// is the case of &quot;file:///path/to/file.txt&quot; where there is no
</span>                <span class="ActionScriptComment">// server - implicit &quot;localhost&quot;).
</span>                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">baseURI</span>.<span class="ActionScriptDefault_Text">substr</span><span class="ActionScriptBracket/Brace">(</span>0, 2<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&quot;//&quot;</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptComment">// Trim all leading slashes
</span>                    <span class="ActionScriptReserved">while</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">baseURI</span>.<span class="ActionScriptDefault_Text">charAt</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&quot;/&quot;</span><span class="ActionScriptBracket/Brace">)</span>
                        <span class="ActionScriptDefault_Text">baseURI</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">baseURI</span>.<span class="ActionScriptDefault_Text">substr</span><span class="ActionScriptBracket/Brace">(</span>1, <span class="ActionScriptDefault_Text">baseURI</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">-</span> 1<span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
        
                <span class="ActionScriptDefault_Text">index</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">baseURI</span>.<span class="ActionScriptDefault_Text">search</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;/&apos;</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">index</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptComment">// No path.  We must have passed something like &quot;http://something.com&quot;
</span>                    <span class="ActionScriptDefault_Text">_authority</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">baseURI</span>;
                    <span class="ActionScriptDefault_Text">_path</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;&quot;</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">else</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">_authority</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">baseURI</span>.<span class="ActionScriptDefault_Text">substr</span><span class="ActionScriptBracket/Brace">(</span>0, <span class="ActionScriptDefault_Text">index</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">_path</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">baseURI</span>.<span class="ActionScriptDefault_Text">substr</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">index</span>, <span class="ActionScriptDefault_Text">baseURI</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">index</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
        
                <span class="ActionScriptComment">// Check to see if the URI has any username or password information.
</span>                <span class="ActionScriptComment">// For example:  ftp://username:password@server.com
</span>                <span class="ActionScriptDefault_Text">index</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_authority</span>.<span class="ActionScriptDefault_Text">search</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;@&apos;</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">index</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptComment">// We have a username and possibly a password
</span>                    <span class="ActionScriptDefault_Text">_username</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_authority</span>.<span class="ActionScriptDefault_Text">substr</span><span class="ActionScriptBracket/Brace">(</span>0, <span class="ActionScriptDefault_Text">index</span><span class="ActionScriptBracket/Brace">)</span>;
        
                    <span class="ActionScriptComment">// Remove the username/password from the authority
</span>                    <span class="ActionScriptDefault_Text">_authority</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_authority</span>.<span class="ActionScriptDefault_Text">substr</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">index</span> <span class="ActionScriptOperator">+</span> 1<span class="ActionScriptBracket/Brace">)</span>;  <span class="ActionScriptComment">// Skip the &apos;@&apos;
</span>        
                    <span class="ActionScriptComment">// Now check to see if the username also has a password
</span>                    <span class="ActionScriptDefault_Text">index</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_username</span>.<span class="ActionScriptDefault_Text">search</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;:&apos;</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">index</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">_password</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_username</span>.<span class="ActionScriptDefault_Text">substring</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">index</span> <span class="ActionScriptOperator">+</span> 1, <span class="ActionScriptDefault_Text">_username</span>.<span class="ActionScriptDefault_Text">length</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptDefault_Text">_username</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_username</span>.<span class="ActionScriptDefault_Text">substr</span><span class="ActionScriptBracket/Brace">(</span>0, <span class="ActionScriptDefault_Text">index</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptReserved">else</span>
                        <span class="ActionScriptDefault_Text">_password</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;&quot;</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">else</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">_username</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;&quot;</span>;
                    <span class="ActionScriptDefault_Text">_password</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;&quot;</span>;
                <span class="ActionScriptBracket/Brace">}</span>
        
                <span class="ActionScriptComment">// Lastly, check to see if the authorty has a port number.
</span>                <span class="ActionScriptComment">// This is parsed after the username/password to avoid conflicting
</span>                <span class="ActionScriptComment">// with the &apos;:&apos; in the &apos;username:password&apos; if one exists.
</span>                <span class="ActionScriptDefault_Text">index</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_authority</span>.<span class="ActionScriptDefault_Text">search</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;:&apos;</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">index</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">_port</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_authority</span>.<span class="ActionScriptDefault_Text">substring</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">index</span> <span class="ActionScriptOperator">+</span> 1, <span class="ActionScriptDefault_Text">_authority</span>.<span class="ActionScriptDefault_Text">length</span><span class="ActionScriptBracket/Brace">)</span>;  <span class="ActionScriptComment">// skip the &apos;:&apos;
</span>                    <span class="ActionScriptDefault_Text">_authority</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_authority</span>.<span class="ActionScriptDefault_Text">substr</span><span class="ActionScriptBracket/Brace">(</span>0, <span class="ActionScriptDefault_Text">index</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">else</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">_port</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;&quot;</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                
                <span class="ActionScriptComment">// Lastly, normalize the authority.  Domain names
</span>                <span class="ActionScriptComment">// are case insensitive.
</span>                <span class="ActionScriptDefault_Text">_authority</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_authority</span>.<span class="ActionScriptDefault_Text">toLowerCase</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">((</span><span class="ActionScriptDefault_Text">_valid</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">validateURI</span><span class="ActionScriptBracket/Brace">())</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">false</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">initialize</span><span class="ActionScriptBracket/Brace">()</span>;  <span class="ActionScriptComment">// Bad URI.  Clear it
</span>        
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">isValid</span><span class="ActionScriptBracket/Brace">()</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        
        <span class="ActionScriptASDoc">/********************************************************************
         * Copy function.
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">copyURI</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">uri</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">URI</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">_scheme</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">uri</span>.<span class="ActionScriptDefault_Text">_scheme</span>;
            <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">_authority</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">uri</span>.<span class="ActionScriptDefault_Text">_authority</span>;
            <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">_username</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">uri</span>.<span class="ActionScriptDefault_Text">_username</span>;
            <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">_password</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">uri</span>.<span class="ActionScriptDefault_Text">_password</span>;
            <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">_port</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">uri</span>.<span class="ActionScriptDefault_Text">_port</span>;
            <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">_path</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">uri</span>.<span class="ActionScriptDefault_Text">_path</span>;
            <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">_query</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">uri</span>.<span class="ActionScriptDefault_Text">_query</span>;
            <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">_fragment</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">uri</span>.<span class="ActionScriptDefault_Text">_fragment</span>;
            <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">_nonHierarchical</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">uri</span>.<span class="ActionScriptDefault_Text">_nonHierarchical</span>;
        
            <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">_valid</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">uri</span>.<span class="ActionScriptDefault_Text">_valid</span>;
            <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">_relative</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">uri</span>.<span class="ActionScriptDefault_Text">_relative</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        
        <span class="ActionScriptASDoc">/**
         * @private
         * Checks if the given string only contains a-z or A-Z.
         */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">verifyAlpha</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">str</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">Boolean</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">pattern</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">RegExp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">/[^a-z]/</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">index</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;
            
            <span class="ActionScriptDefault_Text">str</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">str</span>.<span class="ActionScriptDefault_Text">toLowerCase</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptDefault_Text">index</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">str</span>.<span class="ActionScriptDefault_Text">search</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">pattern</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">index</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">true</span>;
            <span class="ActionScriptReserved">else</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">false</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Is this a valid URI?
         * 
         * @return true if this object represents a valid URI, false
         * otherwise.
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">isValid</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">Boolean</span>
        <span class="ActionScriptBracket/Brace">{</span> 
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">_valid</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        
        <span class="ActionScriptASDoc">/**
         * Is this URI an absolute URI?  An absolute URI is a complete, fully
         * qualified reference to a resource.  e.g. http://site.com/index.htm
         * Non-hierarchical URI&apos;s are always absolute.
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">isAbsolute</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">Boolean</span>
        <span class="ActionScriptBracket/Brace">{</span> 
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptOperator">!</span><span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">_relative</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        
        <span class="ActionScriptASDoc">/**
         * Is this URI a relative URI?  Relative URI&apos;s do not have a scheme
         * and only contain a relative path with optional anchor and query
         * parts.  e.g. &quot;../reports/index.htm&quot;.  Non-hierarchical URI&apos;s
         * will never be relative.
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">isRelative</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">Boolean</span>
        <span class="ActionScriptBracket/Brace">{</span> 
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">_relative</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        
        <span class="ActionScriptASDoc">/**
         * Does this URI point to a resource that is a directory/folder?
         * The URI specification dictates that any path that ends in a slash
         * is a directory.  This is needed to be able to perform correct path
         * logic when combining relative URI&apos;s with absolute URI&apos;s to
         * obtain the correct absolute URI to a resource.
         * 
         * @see URI.chdir
         * 
         * @return true if this URI represents a directory resource, false
         * if this URI represents a file resource.
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">isDirectory</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">Boolean</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_path</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">==</span> 0<span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">false</span>;
        
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_path</span>.<span class="ActionScriptDefault_Text">charAt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">path</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">-</span> 1<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&apos;/&apos;</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        
        <span class="ActionScriptASDoc">/**
         * Is this URI a hierarchical URI? URI&apos;s can be  
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">isHierarchical</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">Boolean</span>
        <span class="ActionScriptBracket/Brace">{</span> 
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">hierState</span>;
        <span class="ActionScriptBracket/Brace">}</span>
                
        
        <span class="ActionScriptASDoc">/**
         * The scheme of the URI.
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">scheme</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">String</span>
        <span class="ActionScriptBracket/Brace">{</span> 
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">URI</span>.<span class="ActionScriptDefault_Text">unescapeChars</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_scheme</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">scheme</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">schemeStr</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptComment">// Normalize the scheme
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">normalized</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">schemeStr</span>.<span class="ActionScriptDefault_Text">toLowerCase</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptDefault_Text">_scheme</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">URI</span>.<span class="ActionScriptDefault_Text">fastEscapeChars</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">normalized</span>, <span class="ActionScriptDefault_Text">URI</span>.<span class="ActionScriptDefault_Text">URIschemeExcludedBitmap</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        
        <span class="ActionScriptASDoc">/**
         * The authority (host) of the URI.  Only valid for
         * hierarchical URI&apos;s.  If the URI is relative, this will
         * be an empty string. When setting this value, the string
         * given is assumed to be unescaped.  When retrieving this
         * value, the resulting string is unescaped.
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">authority</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">String</span>
        <span class="ActionScriptBracket/Brace">{</span> 
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">URI</span>.<span class="ActionScriptDefault_Text">unescapeChars</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_authority</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">authority</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">authorityStr</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptComment">// Normalize the authority
</span>            <span class="ActionScriptDefault_Text">authorityStr</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">authorityStr</span>.<span class="ActionScriptDefault_Text">toLowerCase</span><span class="ActionScriptBracket/Brace">()</span>;
            
            <span class="ActionScriptDefault_Text">_authority</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">URI</span>.<span class="ActionScriptDefault_Text">fastEscapeChars</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">authorityStr</span>,
                <span class="ActionScriptDefault_Text">URI</span>.<span class="ActionScriptDefault_Text">URIauthorityExcludedBitmap</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">// Only hierarchical URI&apos;s can have an authority, make
</span>            <span class="ActionScriptComment">// sure this URI is of the proper format.
</span>            <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">hierState</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        
        <span class="ActionScriptASDoc">/**
         * The username of the URI.  Only valid for hierarchical
         * URI&apos;s.  If the URI is relative, this will be an empty
         * string.
         * 
         * &lt;p&gt;The URI specification allows for authentication
         * credentials to be embedded in the URI as such:&lt;/p&gt;
         * 
         * &lt;p&gt;http://user:passwd&amp;#64;host/path/to/file.htm&lt;/p&gt;
         * 
         * &lt;p&gt;When setting this value, the string
         * given is assumed to be unescaped.  When retrieving this
         * value, the resulting string is unescaped.&lt;/p&gt;
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">username</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">String</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">URI</span>.<span class="ActionScriptDefault_Text">unescapeChars</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_username</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">username</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">usernameStr</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">_username</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">URI</span>.<span class="ActionScriptDefault_Text">fastEscapeChars</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">usernameStr</span>, <span class="ActionScriptDefault_Text">URI</span>.<span class="ActionScriptDefault_Text">URIuserpassExcludedBitmap</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">// Only hierarchical URI&apos;s can have a username.
</span>            <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">hierState</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        
        <span class="ActionScriptASDoc">/**
         * The password of the URI.  Similar to username.
         * @see URI.username
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">password</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">String</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">URI</span>.<span class="ActionScriptDefault_Text">unescapeChars</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_password</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">password</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">passwordStr</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">_password</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">URI</span>.<span class="ActionScriptDefault_Text">fastEscapeChars</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">passwordStr</span>,
                <span class="ActionScriptDefault_Text">URI</span>.<span class="ActionScriptDefault_Text">URIuserpassExcludedBitmap</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">// Only hierarchical URI&apos;s can have a password.
</span>            <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">hierState</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        
        <span class="ActionScriptASDoc">/**
         * The host port number.  Only valid for hierarchical URI&apos;s.  If
         * the URI is relative, this will be an empty string. URI&apos;s can
         * contain the port number of the remote host:
         * 
         * &lt;p&gt;http://site.com:8080/index.htm&lt;/p&gt;
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">port</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">String</span>
        <span class="ActionScriptBracket/Brace">{</span> 
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">URI</span>.<span class="ActionScriptDefault_Text">unescapeChars</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_port</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">port</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">portStr</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">_port</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">URI</span>.<span class="ActionScriptDefault_Text">escapeChars</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">portStr</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">// Only hierarchical URI&apos;s can have a port.
</span>            <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">hierState</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        
        <span class="ActionScriptASDoc">/**
         * The path portion of the URI.  Only valid for hierarchical
         * URI&apos;s.  When setting this value, the string
         * given is assumed to be unescaped.  When retrieving this
         * value, the resulting string is unescaped.
         * 
         * &lt;p&gt;The path portion can be in one of two formats. 1) an absolute
         * path, or 2) a relative path.  An absolute path starts with a
         * slash (&apos;/&apos;), a relative path does not.&lt;/p&gt;
         * 
         * &lt;p&gt;An absolute path may look like:&lt;/p&gt;
         * &lt;listing&gt;/full/path/to/my/file.htm&lt;/listing&gt;
         * 
         * &lt;p&gt;A relative path may look like:&lt;/p&gt;
         * &lt;listing&gt;
         * path/to/my/file.htm
         * ../images/logo.gif
         * ../../reports/index.htm
         * &lt;/listing&gt;
         * 
         * &lt;p&gt;Paths can be absolute or relative.  Note that this not the same as
         * an absolute or relative URI.  An absolute URI can only have absolute
         * paths.  For example:&lt;/p&gt;
         * 
         * &lt;listing&gt;http:/site.com/path/to/file.htm&lt;/listing&gt;
         * 
         * &lt;p&gt;This absolute URI has an absolute path of &quot;/path/to/file.htm&quot;.&lt;/p&gt;
         * 
         * &lt;p&gt;Relative URI&apos;s can have either absolute paths or relative paths.
         * All of the following relative URI&apos;s are valid:&lt;/p&gt;
         * 
         * &lt;listing&gt;
         * /absolute/path/to/file.htm
         * path/to/file.htm
         * ../path/to/file.htm
         * &lt;/listing&gt;
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">path</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">String</span>
        <span class="ActionScriptBracket/Brace">{</span> 
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">URI</span>.<span class="ActionScriptDefault_Text">unescapeChars</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_path</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">path</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">pathStr</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>    
            <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">_path</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">URI</span>.<span class="ActionScriptDefault_Text">fastEscapeChars</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">pathStr</span>, <span class="ActionScriptDefault_Text">URI</span>.<span class="ActionScriptDefault_Text">URIpathExcludedBitmap</span><span class="ActionScriptBracket/Brace">)</span>;
        
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">_scheme</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">UNKNOWN_SCHEME</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// We set the path.  This is a valid URI now.
</span>                <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">_scheme</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;&quot;</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        
            <span class="ActionScriptComment">// Only hierarchical URI&apos;s can have a path.
</span>            <span class="ActionScriptDefault_Text">hierState</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        
        <span class="ActionScriptASDoc">/**
         * The query (CGI) portion of the URI.  This part is valid for
         * both hierarchical and non-hierarchical URI&apos;s.
         * 
         * &lt;p&gt;This accessor should only be used if a custom query syntax
         * is used.  This URI class supports the common &quot;param=value&quot;
         * style query syntax via the get/setQueryValue() and
         * get/setQueryByMap() functions.  Those functions should be used
         * instead if the common syntax is being used.
         * 
         * &lt;p&gt;The URI RFC does not specify any particular
         * syntax for the query part of a URI.  It is intended to allow
         * any format that can be agreed upon by the two communicating hosts.
         * However, most systems have standardized on the typical CGI
         * format:&lt;/p&gt;
         * 
         * &lt;listing&gt;http://site.com/script.php?param1=value1&amp;param2=value2&lt;/listing&gt;
         * 
         * &lt;p&gt;This class has specific support for this query syntax&lt;/p&gt;
         * 
         * &lt;p&gt;This common query format is an array of name/value
         * pairs with its own syntax that is different from the overall URI
         * syntax.  The query has its own escaping logic.  For a query part
         * to be properly escaped and unescaped, it must be split into its
         * component parts.  This accessor escapes/unescapes the entire query
         * part without regard for it&apos;s component parts.  This has the
         * possibliity of leaving the query string in an ambiguious state in
         * regards to its syntax.  If the contents of the query part are
         * important, it is recommended that get/setQueryValue() or
         * get/setQueryByMap() are used instead.&lt;/p&gt;
         * 
         * If a different query syntax is being used, a subclass of URI
         * can be created to handle that specific syntax.
         *  
         * @see URI.getQueryValue, URI.getQueryByMap
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">query</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">String</span>
        <span class="ActionScriptBracket/Brace">{</span> 
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">URI</span>.<span class="ActionScriptDefault_Text">unescapeChars</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_query</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">query</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">queryStr</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">_query</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">URI</span>.<span class="ActionScriptDefault_Text">fastEscapeChars</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">queryStr</span>, <span class="ActionScriptDefault_Text">URI</span>.<span class="ActionScriptDefault_Text">URIqueryExcludedBitmap</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">// both hierarchical and non-hierarchical URI&apos;s can
</span>            <span class="ActionScriptComment">// have a query.  Do not set the hierState.
</span>        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Accessor to the raw query data.  If you are using a custom query
         * syntax, this accessor can be used to get and set the query part
         * directly with no escaping/unescaping.  This should ONLY be used
         * if your application logic is handling custom query logic and
         * handling the proper escaping of the query part.
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">queryRaw</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">String</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">_query</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">queryRaw</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">queryStr</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">_query</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">queryStr</span>;
        <span class="ActionScriptBracket/Brace">}</span>


        <span class="ActionScriptASDoc">/**
         * The fragment (anchor) portion of the URI.  This is valid for
         * both hierarchical and non-hierarchical URI&apos;s.
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">fragment</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">String</span>
        <span class="ActionScriptBracket/Brace">{</span> 
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">URI</span>.<span class="ActionScriptDefault_Text">unescapeChars</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_fragment</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">fragment</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">fragmentStr</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">_fragment</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">URI</span>.<span class="ActionScriptDefault_Text">fastEscapeChars</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">fragmentStr</span>, <span class="ActionScriptDefault_Text">URIfragmentExcludedBitmap</span><span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptComment">// both hierarchical and non-hierarchical URI&apos;s can
</span>            <span class="ActionScriptComment">// have a fragment.  Do not set the hierState.
</span>        <span class="ActionScriptBracket/Brace">}</span>
        
        
        <span class="ActionScriptASDoc">/**
         * The non-hierarchical part of the URI.  For example, if
         * this URI object represents &quot;mailto:somebody@company.com&quot;,
         * this will contain &quot;somebody@company.com&quot;.  This is valid only
         * for non-hierarchical URI&apos;s.  
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">nonHierarchical</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">String</span>
        <span class="ActionScriptBracket/Brace">{</span> 
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">URI</span>.<span class="ActionScriptDefault_Text">unescapeChars</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_nonHierarchical</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">nonHierarchical</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">nonHier</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">_nonHierarchical</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">URI</span>.<span class="ActionScriptDefault_Text">fastEscapeChars</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">nonHier</span>, <span class="ActionScriptDefault_Text">URInonHierexcludedBitmap</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">// This is a non-hierarchical URI.
</span>            <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">hierState</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        
        <span class="ActionScriptASDoc">/**
         * Quick shorthand accessor to set the parts of this URI.
         * The given parts are assumed to be in unescaped form.  If
         * the URI is non-hierarchical (e.g. mailto:) you will need
         * to call SetScheme() and SetNonHierarchical().
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">setParts</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">schemeStr</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>, <span class="ActionScriptDefault_Text">authorityStr</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>,
                <span class="ActionScriptDefault_Text">portStr</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>, <span class="ActionScriptDefault_Text">pathStr</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>, <span class="ActionScriptDefault_Text">queryStr</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>,
                <span class="ActionScriptDefault_Text">fragmentStr</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">scheme</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">schemeStr</span>;
            <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">authority</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">authorityStr</span>;
            <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">port</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">portStr</span>;
            <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">path</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">pathStr</span>;
            <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">query</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">queryStr</span>;
            <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">fragment</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">fragmentStr</span>;

            <span class="ActionScriptDefault_Text">hierState</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        
        <span class="ActionScriptASDoc">/**
         * URI escapes the given character string.  This is similar in function
         * to the global encodeURIComponent() function in ActionScript, but is
         * slightly different in regards to which characters get escaped.  This
         * escapes the characters specified in the URIbaselineExluded set (see class
         * static members).  This is needed for this class to work properly.
         * 
         * &lt;p&gt;If a different set of characters need to be used for the escaping,
         * you may use fastEscapeChars() and specify a custom URIEncodingBitmap
         * that contains the characters your application needs escaped.&lt;/p&gt;
         * 
         * &lt;p&gt;Never pass a full URI to this function.  A URI can only be properly
         * escaped/unescaped when split into its component parts (see RFC 3986
         * section 2.4).  This is due to the fact that the URI component separators
         * could be characters that would normally need to be escaped.&lt;/p&gt;
         * 
         * @param unescaped character string to be escaped.
         * 
         * @return    escaped character string
         * 
         * @see encodeURIComponent
         * @see fastEscapeChars
         */</span>
        <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">escapeChars</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">unescaped</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">String</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptComment">// This uses the excluded set by default.
</span>            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">fastEscapeChars</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">unescaped</span>, <span class="ActionScriptDefault_Text">URI</span>.<span class="ActionScriptDefault_Text">URIbaselineExcludedBitmap</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        

        <span class="ActionScriptASDoc">/**
         * Unescape any URI escaped characters in the given character
         * string.
         * 
         * &lt;p&gt;Never pass a full URI to this function.  A URI can only be properly
         * escaped/unescaped when split into its component parts (see RFC 3986
         * section 2.4).  This is due to the fact that the URI component separators
         * could be characters that would normally need to be escaped.&lt;/p&gt;
         * 
         * @param escaped the escaped string to be unescaped.
         * 
         * @return    unescaped string.
         */</span>
        <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">unescapeChars</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">escaped</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptComment">/*, onlyHighASCII:Boolean = false*/</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">String</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptComment">// We can just use the default AS function.  It seems to
</span>            <span class="ActionScriptComment">// decode everything correctly
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">unescaped</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>;
            <span class="ActionScriptDefault_Text">unescaped</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">decodeURIComponent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">escaped</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">unescaped</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Performance focused function that escapes the given character
         * string using the given URIEncodingBitmap as the rule for what
         * characters need to be escaped.  This function is used by this
         * class and can be used externally to this class to perform
         * escaping on custom character sets.
         * 
         * &lt;p&gt;Never pass a full URI to this function.  A URI can only be properly
         * escaped/unescaped when split into its component parts (see RFC 3986
         * section 2.4).  This is due to the fact that the URI component separators
         * could be characters that would normally need to be escaped.&lt;/p&gt;
         * 
         * @param unescaped        the unescaped string to be escaped
         * @param bitmap        the set of characters that need to be escaped
         * 
         * @return    the escaped string.
         */</span>
        <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">fastEscapeChars</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">unescaped</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>, <span class="ActionScriptDefault_Text">bitmap</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">URIEncodingBitmap</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">String</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">escaped</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;&quot;</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">x</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>, <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;
            
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">unescaped</span>.<span class="ActionScriptDefault_Text">length</span>; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">c</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">unescaped</span>.<span class="ActionScriptDefault_Text">charAt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bitmap</span>.<span class="ActionScriptDefault_Text">ShouldEscape</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">c</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">x</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">c</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">x</span>.<span class="ActionScriptDefault_Text">toString</span><span class="ActionScriptBracket/Brace">(</span>16<span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">c</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">==</span> 1<span class="ActionScriptBracket/Brace">)</span>
                        <span class="ActionScriptDefault_Text">c</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;0&quot;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">c</span>;
                        
                    <span class="ActionScriptDefault_Text">c</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;%&quot;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">c</span>;
                    <span class="ActionScriptDefault_Text">c</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">c</span>.<span class="ActionScriptDefault_Text">toUpperCase</span><span class="ActionScriptBracket/Brace">()</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                
                <span class="ActionScriptDefault_Text">escaped</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">c</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">escaped</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        
        <span class="ActionScriptASDoc">/**
         * Is this URI of a particular scheme type?  For example,
         * passing &quot;http&quot; to a URI object that represents the URI
         * &quot;http://site.com/&quot; would return true.
         * 
         * @param scheme    scheme to check for
         * 
         * @return true if this URI object is of the given type, false
         * otherwise.
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">isOfType</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">scheme</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">Boolean</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptComment">// Schemes are never case sensitive.  Ignore case.
</span>            <span class="ActionScriptDefault_Text">scheme</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">scheme</span>.<span class="ActionScriptDefault_Text">toLowerCase</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">_scheme</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">scheme</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>


        <span class="ActionScriptASDoc">/**
         * Get the value for the specified named in the query part.  This
         * assumes the query part of the URI is in the common
         * &quot;name1=value1&amp;name2=value2&quot; syntax.  Do not call this function
         * if you are using a custom query syntax.
         * 
         * @param name    name of the query value to get.
         * 
         * @return the value of the query name, empty string if the
         * query name does not exist.
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getQueryValue</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">name</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">String</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">map</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Object</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">item</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">value</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>;
        
            <span class="ActionScriptDefault_Text">map</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">getQueryByMap</span><span class="ActionScriptBracket/Brace">()</span>;
        
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">item</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">map</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">item</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">name</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">value</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">map</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">item</span><span class="ActionScriptBracket/Brace">]</span>;
                    <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">value</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
        
            <span class="ActionScriptComment">// Didn&apos;t find the specified key
</span>            <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        

        <span class="ActionScriptASDoc">/**
         * Set the given value on the given query name.  If the given name
         * does not exist, it will automatically add this name/value pair
         * to the query.  If null is passed as the value, it will remove
         * the given item from the query.
         * 
         * &lt;p&gt;This automatically escapes any characters that may conflict with
         * the query syntax so that they are &quot;safe&quot; within the query.  The
         * strings passed are assumed to be literal unescaped name and value.&lt;/p&gt;
         * 
         * @param name    name of the query value to set
         * @param value    value of the query item to set.  If null, this will
         * force the removal of this item from the query.
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">setQueryValue</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">name</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>, <span class="ActionScriptDefault_Text">value</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">map</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Object</span>;

            <span class="ActionScriptDefault_Text">map</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">getQueryByMap</span><span class="ActionScriptBracket/Brace">()</span>;
        
            <span class="ActionScriptComment">// If the key doesn&apos;t exist yet, this will create a new pair in
</span>            <span class="ActionScriptComment">// the map.  If it does exist, this will overwrite the previous
</span>            <span class="ActionScriptComment">// value, which is what we want.
</span>            <span class="ActionScriptDefault_Text">map</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">name</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">value</span>;
        
            <span class="ActionScriptDefault_Text">setQueryByMap</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">map</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        
        <span class="ActionScriptASDoc">/**
         * Get the query of the URI in an Object class that allows for easy
         * access to the query data via Object accessors.  For example:
         * 
         * &lt;listing&gt;
         * var query:Object = uri.getQueryByMap();
         * var value:String = query[&quot;param&quot;];    // get a value
         * query[&quot;param2&quot;] = &quot;foo&quot;;   // set a new value
         * &lt;/listing&gt;
         * 
         * @return Object that contains the name/value pairs of the query.
         * 
         * @see #setQueryByMap
         * @see #getQueryValue
         * @see #setQueryValue
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getQueryByMap</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">Object</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">queryStr</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">pair</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">pairs</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">item</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">name</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>, <span class="ActionScriptDefault_Text">value</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">index</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">map</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Object</span><span class="ActionScriptBracket/Brace">()</span>;
        
        
            <span class="ActionScriptComment">// We need the raw query string, no unescaping.
</span>            <span class="ActionScriptDefault_Text">queryStr</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">_query</span>;
            
            <span class="ActionScriptDefault_Text">pairs</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">queryStr</span>.<span class="ActionScriptDefault_Text">split</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&amp;&apos;</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">pair</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">pairs</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">pair</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">==</span> 0<span class="ActionScriptBracket/Brace">)</span>
                  <span class="ActionScriptReserved">continue</span>;
                  
                <span class="ActionScriptDefault_Text">item</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">pair</span>.<span class="ActionScriptDefault_Text">split</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;=&apos;</span><span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">item</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">&gt;</span> 0<span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptDefault_Text">name</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">item</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptReserved">else</span>
                    <span class="ActionScriptReserved">continue</span>;  <span class="ActionScriptComment">// empty array
</span>                
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">item</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">&gt;</span> 1<span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptDefault_Text">value</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">item</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptReserved">else</span>
                    <span class="ActionScriptDefault_Text">value</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;&quot;</span>;
                    
                <span class="ActionScriptDefault_Text">name</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">queryPartUnescape</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">name</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">value</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">queryPartUnescape</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span><span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptDefault_Text">map</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">name</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">value</span>;
            <span class="ActionScriptBracket/Brace">}</span>
    
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">map</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        

        <span class="ActionScriptASDoc">/**
         * Set the query part of this URI using the given object as the
         * content source.  Any member of the object that has a value of
         * null will not be in the resulting query.
         * 
         * @param map    object that contains the name/value pairs as
         *    members of that object.
         * 
         * @see #getQueryByMap
         * @see #getQueryValue
         * @see #setQueryValue
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">setQueryByMap</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">map</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Object</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">item</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">name</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>, <span class="ActionScriptDefault_Text">value</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">queryStr</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;&quot;</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tmpPair</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">foo</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>;
        
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">item</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">map</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">name</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">item</span>;
                <span class="ActionScriptDefault_Text">value</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">map</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">item</span><span class="ActionScriptBracket/Brace">]</span>;
        
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptDefault_Text">value</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;&quot;</span>;
                
                <span class="ActionScriptComment">// Need to escape the name/value pair so that they
</span>                <span class="ActionScriptComment">// don&apos;t conflict with the query syntax (specifically
</span>                <span class="ActionScriptComment">// &apos;=&apos;, &apos;&amp;&apos;, and &lt;whitespace&gt;).
</span>                <span class="ActionScriptDefault_Text">name</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">queryPartEscape</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">name</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">value</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">queryPartEscape</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span><span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptDefault_Text">tmpPair</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">name</span>;
                
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">&gt;</span> 0<span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">tmpPair</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptString">&quot;=&quot;</span>;
                    <span class="ActionScriptDefault_Text">tmpPair</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">value</span>;
                <span class="ActionScriptBracket/Brace">}</span>

                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">queryStr</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">!=</span> 0<span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptDefault_Text">queryStr</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptString">&apos;&amp;&apos;</span>;  <span class="ActionScriptComment">// Add the separator
</span>        
                <span class="ActionScriptDefault_Text">queryStr</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">tmpPair</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        
            <span class="ActionScriptComment">// We don&apos;t want to escape.  We already escaped the
</span>            <span class="ActionScriptComment">// individual name/value pairs.  If we escaped the
</span>            <span class="ActionScriptComment">// query string again by assigning it to &quot;query&quot;,
</span>            <span class="ActionScriptComment">// we would have double escaping.
</span>            <span class="ActionScriptDefault_Text">_query</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">queryStr</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        
        <span class="ActionScriptASDoc">/**
         * Similar to Escape(), except this also escapes characters that
         * would conflict with the name/value pair query syntax.  This is
         * intended to be called on each individual &quot;name&quot; and &quot;value&quot;
         * in the query making sure that nothing in the name or value
         * strings contain characters that would conflict with the query
         * syntax (e.g. &apos;=&apos; and &apos;&amp;&apos;).
         * 
         * @param unescaped        unescaped string that is to be escaped.
         * 
         * @return escaped string.
         * 
         * @see #queryUnescape
         */</span>
        <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">queryPartEscape</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">unescaped</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">String</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">escaped</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">unescaped</span>;
            <span class="ActionScriptDefault_Text">escaped</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">URI</span>.<span class="ActionScriptDefault_Text">fastEscapeChars</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">unescaped</span>, <span class="ActionScriptDefault_Text">URI</span>.<span class="ActionScriptDefault_Text">URIqueryPartExcludedBitmap</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">escaped</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        

        <span class="ActionScriptASDoc">/**
         * Unescape the individual name/value string pairs.
         * 
         * @param escaped    escaped string to be unescaped
         * 
         * @return unescaped string
         * 
         * @see #queryEscape
         */</span>
        <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">queryPartUnescape</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">escaped</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">String</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">unescaped</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">escaped</span>;
            <span class="ActionScriptDefault_Text">unescaped</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">unescapeChars</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">unescaped</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">unescaped</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Output this URI as a string.  The resulting string is properly
         * escaped and well formed for machine processing.
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">toString</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">String</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptString">&quot;&quot;</span>;
            <span class="ActionScriptReserved">else</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">toStringInternal</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">false</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Output the URI as a string that is easily readable by a human.
         * This outputs the URI with all escape sequences unescaped to
         * their character representation.  This makes the URI easier for
         * a human to read, but the URI could be completely invalid
         * because some unescaped characters may now cause ambiguous parsing.
         * This function should only be used if you want to display a URI to
         * a user.  This function should never be used outside that specific
         * case.
         * 
         * @return the URI in string format with all escape sequences
         * unescaped.
         * 
         * @see #toString
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">toDisplayString</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">String</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">toStringInternal</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        
        <span class="ActionScriptASDoc">/**
         * @private
         * 
         * The guts of toString()
         */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">toStringInternal</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">forDisplay</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">String</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">uri</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;&quot;</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">part</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;&quot;</span>;
        
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">isHierarchical</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">false</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// non-hierarchical URI
</span>        
                <span class="ActionScriptDefault_Text">uri</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">forDisplay</span> <span class="ActionScriptOperator">?</span> <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">scheme</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">_scheme</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">uri</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptString">&quot;:&quot;</span>;
                <span class="ActionScriptDefault_Text">uri</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">forDisplay</span> <span class="ActionScriptOperator">?</span> <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">nonHierarchical</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">_nonHierarchical</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// Hierarchical URI
</span>        
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">isRelative</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">false</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptComment">// If it is not a relative URI, then we want the scheme and
</span>                    <span class="ActionScriptComment">// authority parts in the string.  If it is relative, we
</span>                    <span class="ActionScriptComment">// do NOT want this stuff.
</span>        
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_scheme</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">!=</span> 0<span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">part</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">forDisplay</span> <span class="ActionScriptOperator">?</span> <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">scheme</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">_scheme</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptDefault_Text">uri</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">part</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">&quot;:&quot;</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
        
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_authority</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">!=</span> 0 <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">isOfType</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;file&quot;</span><span class="ActionScriptBracket/Brace">))</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">uri</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptString">&quot;//&quot;</span>;
        
                        <span class="ActionScriptComment">// Add on any username/password associated with this
</span>                        <span class="ActionScriptComment">// authority
</span>                        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_username</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">!=</span> 0<span class="ActionScriptBracket/Brace">)</span>
                        <span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptDefault_Text">part</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">forDisplay</span> <span class="ActionScriptOperator">?</span> <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">username</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">_username</span><span class="ActionScriptBracket/Brace">)</span>;
                            <span class="ActionScriptDefault_Text">uri</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">part</span>;
        
                            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_password</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">!=</span> 0<span class="ActionScriptBracket/Brace">)</span>
                            <span class="ActionScriptBracket/Brace">{</span>
                                <span class="ActionScriptDefault_Text">part</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">forDisplay</span> <span class="ActionScriptOperator">?</span> <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">password</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">_password</span><span class="ActionScriptBracket/Brace">)</span>;
                                <span class="ActionScriptDefault_Text">uri</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptString">&quot;:&quot;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">part</span>;
                            <span class="ActionScriptBracket/Brace">}</span>
        
                            <span class="ActionScriptDefault_Text">uri</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptString">&quot;@&quot;</span>;
                        <span class="ActionScriptBracket/Brace">}</span>
        
                        <span class="ActionScriptComment">// add the authority
</span>                        <span class="ActionScriptDefault_Text">part</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">forDisplay</span> <span class="ActionScriptOperator">?</span> <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">authority</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">_authority</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptDefault_Text">uri</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">part</span>;
        
                        <span class="ActionScriptComment">// Tack on the port number, if any
</span>                        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">port</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">!=</span> 0<span class="ActionScriptBracket/Brace">)</span>
                            <span class="ActionScriptDefault_Text">uri</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptString">&quot;:&quot;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">port</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span>
        
                <span class="ActionScriptComment">// Tack on the path
</span>                <span class="ActionScriptDefault_Text">part</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">forDisplay</span> <span class="ActionScriptOperator">?</span> <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">path</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">_path</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">uri</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">part</span>;
        
            <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptComment">// end hierarchical part
</span>        
            <span class="ActionScriptComment">// Both non-hier and hierarchical have query and fragment parts
</span>        
            <span class="ActionScriptComment">// Add on the query and fragment parts
</span>            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_query</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">!=</span> 0<span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">part</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">forDisplay</span> <span class="ActionScriptOperator">?</span> <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">query</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">_query</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">uri</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptString">&quot;?&quot;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">part</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">fragment</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">!=</span> 0<span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">part</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">forDisplay</span> <span class="ActionScriptOperator">?</span> <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">fragment</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">_fragment</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">uri</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptString">&quot;#&quot;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">part</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">uri</span>;
        <span class="ActionScriptBracket/Brace">}</span>
    
        <span class="ActionScriptASDoc">/**
         * Forcefully ensure that this URI is properly escaped.
         * 
         * &lt;p&gt;Sometimes URI&apos;s are constructed by hand using strings outside
         * this class.  In those cases, it is unlikely the URI has been
         * properly escaped.  This function forcefully escapes this URI
         * by unescaping each part and then re-escaping it.  If the URI
         * did not have any escaping, the first unescape will do nothing
         * and then the re-escape will properly escape everything.  If
         * the URI was already escaped, the unescape and re-escape will
         * essentally be a no-op.  This provides a safe way to make sure
         * a URI is in the proper escaped form.&lt;/p&gt;
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">forceEscape</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptComment">// The accessors for each of the members will unescape
</span>            <span class="ActionScriptComment">// and then re-escape as we get and assign them.
</span>            
            <span class="ActionScriptComment">// Handle the parts that are common for both hierarchical
</span>            <span class="ActionScriptComment">// and non-hierarchical URI&apos;s
</span>            <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">scheme</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">scheme</span>;
            <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">setQueryByMap</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">getQueryByMap</span><span class="ActionScriptBracket/Brace">())</span>;
            <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">fragment</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">fragment</span>;
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">isHierarchical</span><span class="ActionScriptBracket/Brace">())</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">authority</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">authority</span>;
                <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">path</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">path</span>;
                <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">port</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">port</span>;
                <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">username</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">username</span>;
                <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">password</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">password</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">nonHierarchical</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">nonHierarchical</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        
        <span class="ActionScriptASDoc">/**
         * Does this URI point to a resource of the given file type?
         * Given a file extension (or just a file name, this will strip the
         * extension), check to see if this URI points to a file of that
         * type.
         * 
         * @param extension     string that contains a file extension with or
         * without a dot (&quot;html&quot; and &quot;.html&quot; are both valid), or a file
         * name with an extension (e.g. &quot;index.html&quot;).
         * 
         * @return true if this URI points to a resource with the same file
         * file extension as the extension provided, false otherwise.
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">isOfFileType</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">extension</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">Boolean</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">thisExtension</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">index</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;
        
            <span class="ActionScriptDefault_Text">index</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">extension</span>.<span class="ActionScriptDefault_Text">lastIndexOf</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;.&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">index</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// Strip the extension
</span>                <span class="ActionScriptDefault_Text">extension</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">extension</span>.<span class="ActionScriptDefault_Text">substr</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">index</span> <span class="ActionScriptOperator">+</span> 1<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// The caller passed something without a dot in it.  We
</span>                <span class="ActionScriptComment">// will assume that it is just a plain extension (e.g. &quot;html&quot;).
</span>                <span class="ActionScriptComment">// What they passed is exactly what we want
</span>            <span class="ActionScriptBracket/Brace">}</span>
        
            <span class="ActionScriptDefault_Text">thisExtension</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">getExtension</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>;
        
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">thisExtension</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&quot;&quot;</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">false</span>;
        
            <span class="ActionScriptComment">// Compare the extensions ignoring case
</span>            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">compareStr</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">thisExtension</span>, <span class="ActionScriptDefault_Text">extension</span>, <span class="ActionScriptReserved">false</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">==</span> 0<span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">true</span>;
            <span class="ActionScriptReserved">else</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">false</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        
        <span class="ActionScriptASDoc">/**
         * Get the &quot;.xyz&quot; file extension from the filename in the URI.
         * For example, if we have the following URI:
         * 
         * &lt;listing&gt;http://something.com/path/to/my/page.html?form=yes&amp;name=bob#anchor&lt;/listing&gt;
         * 
         * &lt;p&gt;This will return &quot;.html&quot;.&lt;/p&gt;
         * 
         * @param minusDot   If true, this will strip the dot from the extension.
         * If true, the above example would have returned &quot;html&quot;.
         * 
         * @return  the file extension
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getExtension</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">minusDot</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">String</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">filename</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">getFilename</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">extension</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">index</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;
        
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">filename</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&quot;&quot;</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
        
            <span class="ActionScriptDefault_Text">index</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">filename</span>.<span class="ActionScriptDefault_Text">lastIndexOf</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;.&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
        
            <span class="ActionScriptComment">// If it doesn&apos;t have an extension, or if it is a &quot;hidden&quot; file,
</span>            <span class="ActionScriptComment">// it doesn&apos;t have an extension.  Hidden files on unix start with
</span>            <span class="ActionScriptComment">// a dot (e.g. &quot;.login&quot;).
</span>            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">index</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptOperator">-</span>1 <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">index</span> <span class="ActionScriptOperator">==</span> 0<span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
        
            <span class="ActionScriptDefault_Text">extension</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">filename</span>.<span class="ActionScriptDefault_Text">substr</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">index</span><span class="ActionScriptBracket/Brace">)</span>;
        
            <span class="ActionScriptComment">// If the caller does not want the dot, remove it.
</span>            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">minusDot</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">extension</span>.<span class="ActionScriptDefault_Text">charAt</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&quot;.&quot;</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">extension</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">extension</span>.<span class="ActionScriptDefault_Text">substr</span><span class="ActionScriptBracket/Brace">(</span>1<span class="ActionScriptBracket/Brace">)</span>;
        
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">extension</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Quick function to retrieve the file name off the end of a URI.
         * 
         * &lt;p&gt;For example, if the URI is:&lt;/p&gt;
         * &lt;listing&gt;http://something.com/some/path/to/my/file.html&lt;/listing&gt;
         * &lt;p&gt;this function will return &quot;file.html&quot;.&lt;/p&gt;
         * 
         * @param minusExtension true if the file extension should be stripped
         * 
         * @return the file name.  If this URI is a directory, the return
         * value will be empty string.
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getFilename</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">minusExtension</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">String</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">isDirectory</span><span class="ActionScriptBracket/Brace">())</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
        
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">pathStr</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">path</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">filename</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">index</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;
        
            <span class="ActionScriptComment">// Find the last path separator.
</span>            <span class="ActionScriptDefault_Text">index</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">pathStr</span>.<span class="ActionScriptDefault_Text">lastIndexOf</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;/&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
        
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">index</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">filename</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">pathStr</span>.<span class="ActionScriptDefault_Text">substr</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">index</span> <span class="ActionScriptOperator">+</span> 1<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">else</span>
                <span class="ActionScriptDefault_Text">filename</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">pathStr</span>;
        
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">minusExtension</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// The caller has requested that the extension be removed
</span>                <span class="ActionScriptDefault_Text">index</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">filename</span>.<span class="ActionScriptDefault_Text">lastIndexOf</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;.&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
        
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">index</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptDefault_Text">filename</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">filename</span>.<span class="ActionScriptDefault_Text">substr</span><span class="ActionScriptBracket/Brace">(</span>0, <span class="ActionScriptDefault_Text">index</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">filename</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        
        <span class="ActionScriptASDoc">/**
         * @private
         * Helper function to compare strings.
         * 
         * @return true if the two strings are identical, false otherwise.
         */</span>
        <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">compareStr</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">str1</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>, <span class="ActionScriptDefault_Text">str2</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>,
            <span class="ActionScriptDefault_Text">sensitive</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">Boolean</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sensitive</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">false</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">str1</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">str1</span>.<span class="ActionScriptDefault_Text">toLowerCase</span><span class="ActionScriptBracket/Brace">()</span>;
                <span class="ActionScriptDefault_Text">str2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">str2</span>.<span class="ActionScriptDefault_Text">toLowerCase</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">str1</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">str2</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Based on the type of this URI (http, ftp, etc.) get
         * the default port used for that protocol.  This is
         * just intended to be a helper function for the most
         * common cases.
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getDefaultPort</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">String</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_scheme</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&quot;http&quot;</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;80&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_scheme</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&quot;ftp&quot;</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;21&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_scheme</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&quot;file&quot;</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_scheme</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&quot;sftp&quot;</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;22&quot;</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// ssh standard port
</span>            <span class="ActionScriptReserved">else</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// Don&apos;t know the port for this URI type
</span>                <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * @private
         * 
         * This resolves the given URI if the application has a
         * resolver interface defined.  This function does not
         * modify the passed in URI and returns a new URI.
         */</span>
        <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">resolve</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">uri</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">URI</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">URI</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">copy</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">URI</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">URI</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptDefault_Text">copy</span>.<span class="ActionScriptDefault_Text">copyURI</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">uri</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_resolver</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// A resolver class has been registered.  Call it.
</span>                <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">_resolver</span>.<span class="ActionScriptDefault_Text">resolve</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">copy</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// No resolver.  Nothing to do, but we don&apos;t
</span>                <span class="ActionScriptComment">// want to reuse the one passed in.
</span>                <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">copy</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Accessor to set and get the resolver object used by all URI
         * objects to dynamically resolve URI&apos;s before comparison.
         */</span>
        <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">resolver</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">resolver</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IURIResolver</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">_resolver</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">resolver</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">resolver</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">IURIResolver</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">_resolver</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Given another URI, return this URI object&apos;s relation to the one given.
         * URI&apos;s can have 1 of 4 possible relationships.  They can be unrelated,
         * equal, parent, or a child of the given URI.
         * 
         * @param uri    URI to compare this URI object to.
         * @param caseSensitive  true if the URI comparison should be done
         * taking case into account, false if the comparison should be
         * performed case insensitive.
         * 
         * @return URI.NOT_RELATED, URI.CHILD, URI.PARENT, or URI.EQUAL
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getRelation</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">uri</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">URI</span>, <span class="ActionScriptDefault_Text">caseSensitive</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">int</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptComment">// Give the app a chance to resolve these URI&apos;s before we compare them.
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">thisURI</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">URI</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">URI</span>.<span class="ActionScriptDefault_Text">resolve</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">thatURI</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">URI</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">URI</span>.<span class="ActionScriptDefault_Text">resolve</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">uri</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">thisURI</span>.<span class="ActionScriptDefault_Text">isRelative</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">thatURI</span>.<span class="ActionScriptDefault_Text">isRelative</span><span class="ActionScriptBracket/Brace">())</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// You cannot compare relative URI&apos;s due to their lack of context.
</span>                <span class="ActionScriptComment">// You could have two relative URI&apos;s that look like:
</span>                <span class="ActionScriptComment">//        ../../images/
</span>                <span class="ActionScriptComment">//        ../../images/marketing/logo.gif
</span>                <span class="ActionScriptComment">// These may appear related, but you have no overall context
</span>                <span class="ActionScriptComment">// from which to make the comparison.  The first URI could be
</span>                <span class="ActionScriptComment">// from one site and the other URI could be from another site.
</span>                <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">URI</span>.<span class="ActionScriptDefault_Text">NOT_RELATED</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">thisURI</span>.<span class="ActionScriptDefault_Text">isHierarchical</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">false</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">thatURI</span>.<span class="ActionScriptDefault_Text">isHierarchical</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">false</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// One or both of the URI&apos;s are non-hierarchical.
</span>                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(((</span><span class="ActionScriptDefault_Text">thisURI</span>.<span class="ActionScriptDefault_Text">isHierarchical</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">false</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">thatURI</span>.<span class="ActionScriptDefault_Text">isHierarchical</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">))</span> <span class="ActionScriptOperator">||</span>
                    <span class="ActionScriptBracket/Brace">((</span><span class="ActionScriptDefault_Text">thisURI</span>.<span class="ActionScriptDefault_Text">isHierarchical</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">thatURI</span>.<span class="ActionScriptDefault_Text">isHierarchical</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">false</span><span class="ActionScriptBracket/Brace">)))</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptComment">// XOR.  One is hierarchical and the other is
</span>                    <span class="ActionScriptComment">// non-hierarchical.  They cannot be compared.
</span>                    <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">URI</span>.<span class="ActionScriptDefault_Text">NOT_RELATED</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">else</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptComment">// They are both non-hierarchical
</span>                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">thisURI</span>.<span class="ActionScriptDefault_Text">scheme</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptDefault_Text">thatURI</span>.<span class="ActionScriptDefault_Text">scheme</span><span class="ActionScriptBracket/Brace">)</span>
                        <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">URI</span>.<span class="ActionScriptDefault_Text">NOT_RELATED</span>;
        
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">thisURI</span>.<span class="ActionScriptDefault_Text">nonHierarchical</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptDefault_Text">thatURI</span>.<span class="ActionScriptDefault_Text">nonHierarchical</span><span class="ActionScriptBracket/Brace">)</span>
                        <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">URI</span>.<span class="ActionScriptDefault_Text">NOT_RELATED</span>;
                        
                    <span class="ActionScriptComment">// The two non-hierarcical URI&apos;s are equal.
</span>                    <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">URI</span>.<span class="ActionScriptDefault_Text">EQUAL</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">// Ok, this URI and the one we are being compared to are both
</span>            <span class="ActionScriptComment">// absolute hierarchical URI&apos;s.
</span>        
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">thisURI</span>.<span class="ActionScriptDefault_Text">scheme</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptDefault_Text">thatURI</span>.<span class="ActionScriptDefault_Text">scheme</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">URI</span>.<span class="ActionScriptDefault_Text">NOT_RELATED</span>;
        
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">thisURI</span>.<span class="ActionScriptDefault_Text">authority</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptDefault_Text">thatURI</span>.<span class="ActionScriptDefault_Text">authority</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">URI</span>.<span class="ActionScriptDefault_Text">NOT_RELATED</span>;
        
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">thisPort</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">thisURI</span>.<span class="ActionScriptDefault_Text">port</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">thatPort</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">thatURI</span>.<span class="ActionScriptDefault_Text">port</span>;
            
            <span class="ActionScriptComment">// Different ports are considered completely different servers.
</span>            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">thisPort</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&quot;&quot;</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">thisPort</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">thisURI</span>.<span class="ActionScriptDefault_Text">getDefaultPort</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">thatPort</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&quot;&quot;</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">thatPort</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">thatURI</span>.<span class="ActionScriptDefault_Text">getDefaultPort</span><span class="ActionScriptBracket/Brace">()</span>;
        
            <span class="ActionScriptComment">// Check to see if the port is the default port.
</span>            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">thisPort</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptDefault_Text">thatPort</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">URI</span>.<span class="ActionScriptDefault_Text">NOT_RELATED</span>;
        
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">compareStr</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">thisURI</span>.<span class="ActionScriptDefault_Text">path</span>, <span class="ActionScriptDefault_Text">thatURI</span>.<span class="ActionScriptDefault_Text">path</span>, <span class="ActionScriptDefault_Text">caseSensitive</span><span class="ActionScriptBracket/Brace">))</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">URI</span>.<span class="ActionScriptDefault_Text">EQUAL</span>;
        
            <span class="ActionScriptComment">// Special case check.  If we are here, the scheme, authority,
</span>            <span class="ActionScriptComment">// and port match, and it is not a relative path, but the
</span>            <span class="ActionScriptComment">// paths did not match.  There is a special case where we
</span>            <span class="ActionScriptComment">// could have:
</span>            <span class="ActionScriptComment">//        http://something.com/
</span>            <span class="ActionScriptComment">//        http://something.com
</span>            <span class="ActionScriptComment">// Technically, these are equal.  So lets, check for this case.
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">thisPath</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">thisURI</span>.<span class="ActionScriptDefault_Text">path</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">thatPath</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">thatURI</span>.<span class="ActionScriptDefault_Text">path</span>;
        
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">thisPath</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&quot;/&quot;</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">thatPath</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&quot;/&quot;</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&amp;&amp;</span>
                 <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">thisPath</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&quot;&quot;</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">thatPath</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&quot;&quot;</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// We hit the special case.  These two are equal.
</span>                <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">URI</span>.<span class="ActionScriptDefault_Text">EQUAL</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        
            <span class="ActionScriptComment">// Ok, the paths do not match, but one path may be a parent/child
</span>            <span class="ActionScriptComment">// of the other.  For example, we may have:
</span>            <span class="ActionScriptComment">//        http://something.com/path/to/homepage/
</span>            <span class="ActionScriptComment">//        http://something.com/path/to/homepage/images/logo.gif
</span>            <span class="ActionScriptComment">// In this case, the first is a parent of the second (or the second
</span>            <span class="ActionScriptComment">// is a child of the first, depending on which you compare to the
</span>            <span class="ActionScriptComment">// other).  To make this comparison, we must split the path into
</span>            <span class="ActionScriptComment">// its component parts (split the string on the &apos;/&apos; path delimiter).
</span>            <span class="ActionScriptComment">// We then compare the 
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">thisParts</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span>, <span class="ActionScriptDefault_Text">thatParts</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">thisPart</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>, <span class="ActionScriptDefault_Text">thatPart</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;
        
            <span class="ActionScriptDefault_Text">thisParts</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">thisPath</span>.<span class="ActionScriptDefault_Text">split</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;/&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">thatParts</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">thatPath</span>.<span class="ActionScriptDefault_Text">split</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;/&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
        
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">thisParts</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">&gt;</span> <span class="ActionScriptDefault_Text">thatParts</span>.<span class="ActionScriptDefault_Text">length</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">thatPart</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">thatParts</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">thatParts</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">-</span> 1<span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">thatPart</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">&gt;</span> 0<span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptComment">// if the last part is not empty, the passed URI is
</span>                    <span class="ActionScriptComment">// not a directory.  There is no way the passed URI
</span>                    <span class="ActionScriptComment">// can be a parent.
</span>                    <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">URI</span>.<span class="ActionScriptDefault_Text">NOT_RELATED</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">else</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptComment">// Remove the empty trailing part
</span>                    <span class="ActionScriptDefault_Text">thatParts</span>.<span class="ActionScriptDefault_Text">pop</span><span class="ActionScriptBracket/Brace">()</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                
                <span class="ActionScriptComment">// This may be a child of the one passed in
</span>                <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">thatParts</span>.<span class="ActionScriptDefault_Text">length</span>; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">thisPart</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">thisParts</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>;
                    <span class="ActionScriptDefault_Text">thatPart</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">thatParts</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>;
                        
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">compareStr</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">thisPart</span>, <span class="ActionScriptDefault_Text">thatPart</span>, <span class="ActionScriptDefault_Text">caseSensitive</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">false</span><span class="ActionScriptBracket/Brace">)</span>
                        <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">URI</span>.<span class="ActionScriptDefault_Text">NOT_RELATED</span>;
                <span class="ActionScriptBracket/Brace">}</span>
        
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">URI</span>.<span class="ActionScriptDefault_Text">CHILD</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">thisParts</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">thatParts</span>.<span class="ActionScriptDefault_Text">length</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">thisPart</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">thisParts</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">thisParts</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">-</span> 1<span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">thisPart</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">&gt;</span> 0<span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptComment">// if the last part is not empty, this URI is not a
</span>                    <span class="ActionScriptComment">// directory.  There is no way this object can be
</span>                    <span class="ActionScriptComment">// a parent.
</span>                    <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">URI</span>.<span class="ActionScriptDefault_Text">NOT_RELATED</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">else</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptComment">// Remove the empty trailing part
</span>                    <span class="ActionScriptDefault_Text">thisParts</span>.<span class="ActionScriptDefault_Text">pop</span><span class="ActionScriptBracket/Brace">()</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                
                <span class="ActionScriptComment">// This may be the parent of the one passed in
</span>                <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">thisParts</span>.<span class="ActionScriptDefault_Text">length</span>; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">thisPart</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">thisParts</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>;
                    <span class="ActionScriptDefault_Text">thatPart</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">thatParts</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>;
        
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">compareStr</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">thisPart</span>, <span class="ActionScriptDefault_Text">thatPart</span>, <span class="ActionScriptDefault_Text">caseSensitive</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">false</span><span class="ActionScriptBracket/Brace">)</span>
                        <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">URI</span>.<span class="ActionScriptDefault_Text">NOT_RELATED</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">URI</span>.<span class="ActionScriptDefault_Text">PARENT</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// Both URI&apos;s have the same number of path components, but
</span>                <span class="ActionScriptComment">// it failed the equivelence check above.  This means that
</span>                <span class="ActionScriptComment">// the two URI&apos;s are not related.
</span>                <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">URI</span>.<span class="ActionScriptDefault_Text">NOT_RELATED</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">// If we got here, the scheme and authority are the same,
</span>            <span class="ActionScriptComment">// but the paths pointed to two different locations that
</span>            <span class="ActionScriptComment">// were in different parts of the file system tree
</span>            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">URI</span>.<span class="ActionScriptDefault_Text">NOT_RELATED</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Given another URI, return the common parent between this one
         * and the provided URI.
         * 
         * @param uri the other URI from which to find a common parent
         * @para caseSensitive true if this operation should be done
         * with case sensitive comparisons.
         * 
         * @return the parent URI if successful, null otherwise.
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getCommonParent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">uri</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">URI</span>, <span class="ActionScriptDefault_Text">caseSensitive</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">URI</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">thisURI</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">URI</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">URI</span>.<span class="ActionScriptDefault_Text">resolve</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">thatURI</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">URI</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">URI</span>.<span class="ActionScriptDefault_Text">resolve</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">uri</span><span class="ActionScriptBracket/Brace">)</span>;
        
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(!</span><span class="ActionScriptDefault_Text">thisURI</span>.<span class="ActionScriptDefault_Text">isAbsolute</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptOperator">!</span><span class="ActionScriptDefault_Text">thatURI</span>.<span class="ActionScriptDefault_Text">isAbsolute</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">||</span>
                <span class="ActionScriptDefault_Text">thisURI</span>.<span class="ActionScriptDefault_Text">isHierarchical</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">false</span> <span class="ActionScriptOperator">||</span>
                <span class="ActionScriptDefault_Text">thatURI</span>.<span class="ActionScriptDefault_Text">isHierarchical</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">false</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// Both URI&apos;s must be absolute hierarchical for this to
</span>                <span class="ActionScriptComment">// make sense.
</span>                <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">null</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">relation</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">thisURI</span>.<span class="ActionScriptDefault_Text">getRelation</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">thatURI</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">relation</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">URI</span>.<span class="ActionScriptDefault_Text">NOT_RELATED</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// The given URI is not related to this one.  No
</span>                <span class="ActionScriptComment">// common parent.
</span>                <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">null</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        
            <span class="ActionScriptDefault_Text">thisURI</span>.<span class="ActionScriptDefault_Text">chdir</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;.&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">thatURI</span>.<span class="ActionScriptDefault_Text">chdir</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;.&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">strBefore</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>, <span class="ActionScriptDefault_Text">strAfter</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>;
            <span class="ActionScriptReserved">do</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">relation</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">thisURI</span>.<span class="ActionScriptDefault_Text">getRelation</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">thatURI</span>, <span class="ActionScriptDefault_Text">caseSensitive</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">relation</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">URI</span>.<span class="ActionScriptDefault_Text">EQUAL</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">relation</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">URI</span>.<span class="ActionScriptDefault_Text">PARENT</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptReserved">break</span>;
        
                <span class="ActionScriptComment">// If strBefore and strAfter end up being the same,
</span>                <span class="ActionScriptComment">// we know we are at the root of the path because
</span>                <span class="ActionScriptComment">// chdir(&quot;..&quot;) is doing nothing.
</span>                <span class="ActionScriptDefault_Text">strBefore</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">thisURI</span>.<span class="ActionScriptDefault_Text">toString</span><span class="ActionScriptBracket/Brace">()</span>;
                <span class="ActionScriptDefault_Text">thisURI</span>.<span class="ActionScriptDefault_Text">chdir</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;..&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">strAfter</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">thisURI</span>.<span class="ActionScriptDefault_Text">toString</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">while</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">strBefore</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptDefault_Text">strAfter</span><span class="ActionScriptBracket/Brace">)</span>;
        
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">thisURI</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        
        <span class="ActionScriptASDoc">/**
         * This function is used to move around in a URI in a way similar
         * to the &apos;cd&apos; or &apos;chdir&apos; commands on Unix.  These operations are
         * completely string based, using the context of the URI to
         * determine the position within the path.  The heuristics used
         * to determine the action are based off Appendix C in RFC 2396.
         * 
         * &lt;p&gt;URI paths that end in &apos;/&apos; are considered paths that point to
         * directories, while paths that do not end in &apos;/&apos; are files.  For
         * example, if you execute chdir(&quot;d&quot;) on the following URI&apos;s:&lt;br/&gt;
         *    1.  http://something.com/a/b/c/  (directory)&lt;br/&gt;
         *    2.  http://something.com/a/b/c  (not directory)&lt;br/&gt;
         * you will get:&lt;br/&gt;
         *    1.  http://something.com/a/b/c/d&lt;br/&gt;
         *    2.  http://something.com/a/b/d&lt;br/&gt;&lt;/p&gt;
         * 
         * &lt;p&gt;See RFC 2396, Appendix C for more info.&lt;/p&gt;
         * 
         * @param reference    the URI or path to &quot;cd&quot; to.
         * @param escape true if the passed reference string should be URI
         * escaped before using it.
         * 
         * @return true if the chdir was successful, false otherwise.
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">chdir</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">reference</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>, <span class="ActionScriptDefault_Text">escape</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">Boolean</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">uriReference</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">URI</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ref</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">reference</span>;
        
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">escape</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">ref</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">URI</span>.<span class="ActionScriptDefault_Text">escapeChars</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">reference</span><span class="ActionScriptBracket/Brace">)</span>;
        
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ref</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&quot;&quot;</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// NOOP
</span>                <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">true</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ref</span>.<span class="ActionScriptDefault_Text">substr</span><span class="ActionScriptBracket/Brace">(</span>0, 2<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&quot;//&quot;</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// Special case.  This is an absolute URI but without the scheme.
</span>                <span class="ActionScriptComment">// Take the scheme from this URI and tack it on.  This is
</span>                <span class="ActionScriptComment">// intended to make working with chdir() a little more
</span>                <span class="ActionScriptComment">// tolerant.
</span>                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">f</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">scheme</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">&quot;:&quot;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">ref</span>;
                
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">constructURI</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">f</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ref</span>.<span class="ActionScriptDefault_Text">charAt</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&quot;?&quot;</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// A relative URI that is just a query part is essentially
</span>                <span class="ActionScriptComment">// a &quot;./?query&quot;.  We tack on the &quot;./&quot; here to make the rest
</span>                <span class="ActionScriptComment">// of our logic work.
</span>                <span class="ActionScriptDefault_Text">ref</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;./&quot;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">ref</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        
            <span class="ActionScriptComment">// Parse the reference passed in as a URI.  This way we
</span>            <span class="ActionScriptComment">// get any query and fragments parsed out as well.
</span>            <span class="ActionScriptDefault_Text">uriReference</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">URI</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ref</span><span class="ActionScriptBracket/Brace">)</span>;
        
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">uriReference</span>.<span class="ActionScriptDefault_Text">isAbsolute</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">||</span>
                <span class="ActionScriptDefault_Text">uriReference</span>.<span class="ActionScriptDefault_Text">isHierarchical</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">false</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// If the URI given is a full URI, it replaces this one.
</span>                <span class="ActionScriptDefault_Text">copyURI</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">uriReference</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">true</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        
        
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">thisPath</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>, <span class="ActionScriptDefault_Text">thatPath</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">thisParts</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span>, <span class="ActionScriptDefault_Text">thatParts</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">thisIsDir</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>, <span class="ActionScriptDefault_Text">thatIsDir</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">thisIsAbs</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>, <span class="ActionScriptDefault_Text">thatIsAbs</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">lastIsDotOperation</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">curDir</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;
        
            <span class="ActionScriptDefault_Text">thisPath</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">path</span>;
            <span class="ActionScriptDefault_Text">thatPath</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">uriReference</span>.<span class="ActionScriptDefault_Text">path</span>;
        
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">thisPath</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">&gt;</span> 0<span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">thisParts</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">thisPath</span>.<span class="ActionScriptDefault_Text">split</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;/&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">else</span>
                <span class="ActionScriptDefault_Text">thisParts</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptBracket/Brace">()</span>;
                
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">thatPath</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">&gt;</span> 0<span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">thatParts</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">thatPath</span>.<span class="ActionScriptDefault_Text">split</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;/&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">else</span>
                <span class="ActionScriptDefault_Text">thatParts</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptBracket/Brace">()</span>;
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">thisParts</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">&gt;</span> 0 <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">thisParts</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&quot;&quot;</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">thisIsAbs</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
                <span class="ActionScriptDefault_Text">thisParts</span>.<span class="ActionScriptDefault_Text">shift</span><span class="ActionScriptBracket/Brace">()</span>; <span class="ActionScriptComment">// pop the first one off the array
</span>            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">thisParts</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">&gt;</span> 0 <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">thisParts</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">thisParts</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">-</span> 1<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&quot;&quot;</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">thisIsDir</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
                <span class="ActionScriptDefault_Text">thisParts</span>.<span class="ActionScriptDefault_Text">pop</span><span class="ActionScriptBracket/Brace">()</span>;  <span class="ActionScriptComment">// pop the last one off the array
</span>            <span class="ActionScriptBracket/Brace">}</span>
                
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">thatParts</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">&gt;</span> 0 <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">thatParts</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&quot;&quot;</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">thatIsAbs</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
                <span class="ActionScriptDefault_Text">thatParts</span>.<span class="ActionScriptDefault_Text">shift</span><span class="ActionScriptBracket/Brace">()</span>; <span class="ActionScriptComment">// pop the first one off the array
</span>            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">thatParts</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">&gt;</span> 0 <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">thatParts</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">thatParts</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">-</span> 1<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&quot;&quot;</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">thatIsDir</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
                <span class="ActionScriptDefault_Text">thatParts</span>.<span class="ActionScriptDefault_Text">pop</span><span class="ActionScriptBracket/Brace">()</span>;  <span class="ActionScriptComment">// pop the last one off the array
</span>            <span class="ActionScriptBracket/Brace">}</span>
                
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">thatIsAbs</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// The reference is an absolute path (starts with a slash).
</span>                <span class="ActionScriptComment">// It replaces this path wholesale.
</span>                <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">path</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">uriReference</span>.<span class="ActionScriptDefault_Text">path</span>;
        
                <span class="ActionScriptComment">// And it inherits the query and fragment
</span>                <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">queryRaw</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">uriReference</span>.<span class="ActionScriptDefault_Text">queryRaw</span>;
                <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">fragment</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">uriReference</span>.<span class="ActionScriptDefault_Text">fragment</span>;
        
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">true</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">thatParts</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">==</span> 0 <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">uriReference</span>.<span class="ActionScriptDefault_Text">query</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&quot;&quot;</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// The reference must have only been a fragment.  Fragments just
</span>                <span class="ActionScriptComment">// get appended to whatever the current path is.  We don&apos;t want
</span>                <span class="ActionScriptComment">// to overwrite any query that may already exist, so this case
</span>                <span class="ActionScriptComment">// only takes on the new fragment.
</span>                <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">fragment</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">uriReference</span>.<span class="ActionScriptDefault_Text">fragment</span>;
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">true</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">thisIsDir</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">false</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">thisParts</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">&gt;</span> 0<span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// This path ends in a file.  It goes away no matter what.
</span>                <span class="ActionScriptDefault_Text">thisParts</span>.<span class="ActionScriptDefault_Text">pop</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        
            <span class="ActionScriptComment">// By default, this assumes the query and fragment of the reference
</span>            <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">queryRaw</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">uriReference</span>.<span class="ActionScriptDefault_Text">queryRaw</span>;
            <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">fragment</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">uriReference</span>.<span class="ActionScriptDefault_Text">fragment</span>;
        
            <span class="ActionScriptComment">// Append the parts of the path from the passed in reference
</span>            <span class="ActionScriptComment">// to this object&apos;s path.
</span>            <span class="ActionScriptDefault_Text">thisParts</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">thisParts</span>.<span class="ActionScriptDefault_Text">concat</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">thatParts</span><span class="ActionScriptBracket/Brace">)</span>;
                    
            <span class="ActionScriptReserved">for</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">thisParts</span>.<span class="ActionScriptDefault_Text">length</span>; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">curDir</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">thisParts</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptDefault_Text">lastIsDotOperation</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
        
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">curDir</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&quot;.&quot;</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">thisParts</span>.<span class="ActionScriptDefault_Text">splice</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span>, 1<span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">-</span> 1;  <span class="ActionScriptComment">// account for removing this item
</span>                    <span class="ActionScriptDefault_Text">lastIsDotOperation</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">curDir</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&quot;..&quot;</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&gt;=</span> 1<span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">thisParts</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">-</span> 1<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&quot;..&quot;</span><span class="ActionScriptBracket/Brace">)</span>
                        <span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptComment">// If the previous is a &quot;..&quot;, we must have skipped
</span>                            <span class="ActionScriptComment">// it due to this URI being relative.  We can&apos;t
</span>                            <span class="ActionScriptComment">// collapse leading &quot;..&quot;s in a relative URI, so
</span>                            <span class="ActionScriptComment">// do nothing.
</span>                        <span class="ActionScriptBracket/Brace">}</span>
                        <span class="ActionScriptReserved">else</span>
                        <span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptDefault_Text">thisParts</span>.<span class="ActionScriptDefault_Text">splice</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">-</span> 1, 2<span class="ActionScriptBracket/Brace">)</span>;
                            <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">-</span> 2;  <span class="ActionScriptComment">// move back to account for the 2 we removed
</span>                        <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptReserved">else</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptComment">// This is the first thing in the path.
</span>        
                        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">isRelative</span><span class="ActionScriptBracket/Brace">())</span>
                        <span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptComment">// We can&apos;t collapse leading &quot;..&quot;s in a relative
</span>                            <span class="ActionScriptComment">// path.  Do noting.
</span>                        <span class="ActionScriptBracket/Brace">}</span>
                        <span class="ActionScriptReserved">else</span>
                        <span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptComment">// This is an abnormal case.  We have dot-dotted up
</span>                            <span class="ActionScriptComment">// past the base of our &quot;file system&quot;.  This is a
</span>                            <span class="ActionScriptComment">// case where we had a /path/like/this.htm and were
</span>                            <span class="ActionScriptComment">// given a path to chdir to like this:
</span>                            <span class="ActionScriptComment">// ../../../../../../mydir
</span>                            <span class="ActionScriptComment">// Obviously, it has too many &quot;..&quot; and will take us
</span>                            <span class="ActionScriptComment">// up beyond the top of the URI.  However, according
</span>                            <span class="ActionScriptComment">// RFC 2396 Appendix C.2, we should try to handle
</span>                            <span class="ActionScriptComment">// these abnormal cases appropriately.  In this case,
</span>                            <span class="ActionScriptComment">// we will do what UNIX command lines do if you are
</span>                            <span class="ActionScriptComment">// at the root (/) of the filesystem and execute:
</span>                            <span class="ActionScriptComment">// # cd ../../../../../bin
</span>                            <span class="ActionScriptComment">// Which will put you in /bin.  Essentially, the extra
</span>                            <span class="ActionScriptComment">// &quot;..&quot;&apos;s will just get eaten.
</span>        
                            <span class="ActionScriptDefault_Text">thisParts</span>.<span class="ActionScriptDefault_Text">splice</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span>, 1<span class="ActionScriptBracket/Brace">)</span>;
                            <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">-</span> 1;  <span class="ActionScriptComment">// account for the &quot;..&quot; we just removed
</span>                        <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptBracket/Brace">}</span>
        
                    <span class="ActionScriptDefault_Text">lastIsDotOperation</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">finalPath</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;&quot;</span>;
        
            <span class="ActionScriptComment">// If the last thing in the path was a &quot;.&quot; or &quot;..&quot;, then this thing is a
</span>            <span class="ActionScriptComment">// directory.  If the last thing isn&apos;t a dot-op, then we don&apos;t want to 
</span>            <span class="ActionScriptComment">// blow away any information about the directory (hence the &quot;|=&quot; binary
</span>            <span class="ActionScriptComment">// assignment).
</span>            <span class="ActionScriptDefault_Text">thatIsDir</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">thatIsDir</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">lastIsDotOperation</span>;
        
            <span class="ActionScriptComment">// Reconstruct the path with the abs/dir info we have
</span>            <span class="ActionScriptDefault_Text">finalPath</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">joinPath</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">thisParts</span>, <span class="ActionScriptDefault_Text">thisIsAbs</span>, <span class="ActionScriptDefault_Text">thatIsDir</span><span class="ActionScriptBracket/Brace">)</span>;
        
            <span class="ActionScriptComment">// Set the path (automatically escaping it)
</span>            <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">path</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">finalPath</span>;
        
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">true</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * @private
         * Join an array of path parts back into a URI style path string.
         * This is used by the various path logic functions to recombine
         * a path.  This is different than the standard Array.join()
         * function because we need to take into account the starting and
         * ending path delimiters if this is an absolute path or a
         * directory.
         * 
         * @param parts    the Array that contains strings of each path part.
         * @param isAbs        true if the given path is absolute
         * @param isDir        true if the given path is a directory
         * 
         * @return the combined path string.
         */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">joinPath</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">parts</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span>, <span class="ActionScriptDefault_Text">isAbs</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span>, <span class="ActionScriptDefault_Text">isDir</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">String</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">pathStr</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;&quot;</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;
        
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">parts</span>.<span class="ActionScriptDefault_Text">length</span>; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">pathStr</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">&gt;</span> 0<span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptDefault_Text">pathStr</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptString">&quot;/&quot;</span>;
        
                <span class="ActionScriptDefault_Text">pathStr</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">parts</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        
            <span class="ActionScriptComment">// If this path is a directory, tack on the directory delimiter,
</span>            <span class="ActionScriptComment">// but only if the path contains something.  Adding this to an
</span>            <span class="ActionScriptComment">// empty path would make it &quot;/&quot;, which is an absolute path that
</span>            <span class="ActionScriptComment">// starts at the root.
</span>            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">isDir</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">pathStr</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">&gt;</span> 0<span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">pathStr</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptString">&quot;/&quot;</span>;
        
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">isAbs</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">pathStr</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;/&quot;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">pathStr</span>;
        
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">pathStr</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Given an absolute URI, make this relative URI absolute using
         * the given URI as a base.  This URI instance must be relative
         * and the base_uri must be absolute.
         * 
         * @param base_uri    URI to use as the base from which to make
         * this relative URI into an absolute URI.
         * 
         * @return true if successful, false otherwise.
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">makeAbsoluteURI</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">base_uri</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">URI</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">Boolean</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">isAbsolute</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">base_uri</span>.<span class="ActionScriptDefault_Text">isRelative</span><span class="ActionScriptBracket/Brace">())</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// This URI needs to be relative, and the base needs to be
</span>                <span class="ActionScriptComment">// absolute otherwise we won&apos;t know what to do!
</span>                <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">false</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        
            <span class="ActionScriptComment">// Make a copy of the base URI.  We don&apos;t want to modify
</span>            <span class="ActionScriptComment">// the passed URI.
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">base</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">URI</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">URI</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptDefault_Text">base</span>.<span class="ActionScriptDefault_Text">copyURI</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">base_uri</span><span class="ActionScriptBracket/Brace">)</span>;
        
            <span class="ActionScriptComment">// ChDir on the base URI.  This will preserve any query
</span>            <span class="ActionScriptComment">// and fragment we have.
</span>            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">base</span>.<span class="ActionScriptDefault_Text">chdir</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">toString</span><span class="ActionScriptBracket/Brace">())</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">false</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">false</span>;
        
            <span class="ActionScriptComment">// It worked, so copy the base into this one
</span>            <span class="ActionScriptDefault_Text">copyURI</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">base</span><span class="ActionScriptBracket/Brace">)</span>;
        
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">true</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        
        <span class="ActionScriptASDoc">/**
         * Given a URI to use as a base from which this object should be
         * relative to, convert this object into a relative URI.  For example,
         * if you have:
         * 
         * &lt;listing&gt;
         * var uri1:URI = new URI(&quot;http://something.com/path/to/some/file.html&quot;);
         * var uri2:URI = new URI(&quot;http://something.com/path/to/another/file.html&quot;);
         * 
         * uri1.MakeRelativePath(uri2);&lt;/listing&gt;
         * 
         * &lt;p&gt;uri1 will have a final value of &quot;../some/file.html&quot;&lt;/p&gt;
         * 
         * &lt;p&gt;Note! This function is brute force.  If you have two URI&apos;s
         * that are completely unrelated, this will still attempt to make
         * the relative URI.  In that case, you will most likely get a
         * relative path that looks something like:&lt;/p&gt;
         * 
         * &lt;p&gt;../../../../../../some/path/to/my/file.html&lt;/p&gt;
         * 
         * @param base_uri the URI from which to make this URI relative
         * 
         * @return true if successful, false if the base_uri and this URI
         * are not related, of if error.
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">makeRelativeURI</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">base_uri</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">URI</span>, <span class="ActionScriptDefault_Text">caseSensitive</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">Boolean</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">base</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">URI</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">URI</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptDefault_Text">base</span>.<span class="ActionScriptDefault_Text">copyURI</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">base_uri</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">thisParts</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span>, <span class="ActionScriptDefault_Text">thatParts</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">finalParts</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">thisPart</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>, <span class="ActionScriptDefault_Text">thatPart</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>, <span class="ActionScriptDefault_Text">finalPath</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">pathStr</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">path</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">queryStr</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">queryRaw</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">fragmentStr</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">fragment</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">diff</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">isDir</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
        
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">isRelative</span><span class="ActionScriptBracket/Brace">())</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// We&apos;re already relative.
</span>                <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">true</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">base</span>.<span class="ActionScriptDefault_Text">isRelative</span><span class="ActionScriptBracket/Brace">())</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// The base is relative.  A relative base doesn&apos;t make sense.
</span>                <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">false</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        
        
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">isOfType</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">base_uri</span>.<span class="ActionScriptDefault_Text">scheme</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">false</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">||</span>
                <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">authority</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptDefault_Text">base_uri</span>.<span class="ActionScriptDefault_Text">authority</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// The schemes and/or authorities are different.  We can&apos;t
</span>                <span class="ActionScriptComment">// make a relative path to something that is completely
</span>                <span class="ActionScriptComment">// unrelated.
</span>                <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">false</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        
            <span class="ActionScriptComment">// Record the state of this URI
</span>            <span class="ActionScriptDefault_Text">isDir</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">isDirectory</span><span class="ActionScriptBracket/Brace">()</span>;
        
            <span class="ActionScriptComment">// We are based of the directory of the given URI.  We need to
</span>            <span class="ActionScriptComment">// make sure the URI is pointing to a directory.  Changing
</span>            <span class="ActionScriptComment">// directory to &quot;.&quot; will remove any file name if the base is
</span>            <span class="ActionScriptComment">// not a directory.
</span>            <span class="ActionScriptDefault_Text">base</span>.<span class="ActionScriptDefault_Text">chdir</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;.&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
        
            <span class="ActionScriptDefault_Text">thisParts</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">pathStr</span>.<span class="ActionScriptDefault_Text">split</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;/&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">thatParts</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">base</span>.<span class="ActionScriptDefault_Text">path</span>.<span class="ActionScriptDefault_Text">split</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;/&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">thisParts</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">&gt;</span> 0 <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">thisParts</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&quot;&quot;</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">thisParts</span>.<span class="ActionScriptDefault_Text">shift</span><span class="ActionScriptBracket/Brace">()</span>;
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">thisParts</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">&gt;</span> 0 <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">thisParts</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">thisParts</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">-</span> 1<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&quot;&quot;</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">isDir</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
                <span class="ActionScriptDefault_Text">thisParts</span>.<span class="ActionScriptDefault_Text">pop</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">thatParts</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">&gt;</span> 0 <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">thatParts</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&quot;&quot;</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">thatParts</span>.<span class="ActionScriptDefault_Text">shift</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">thatParts</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">&gt;</span> 0 <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">thatParts</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">thatParts</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">-</span> 1<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&quot;&quot;</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">thatParts</span>.<span class="ActionScriptDefault_Text">pop</span><span class="ActionScriptBracket/Brace">()</span>;
        
        
            <span class="ActionScriptComment">// Now that we have the paths split into an array of directories,
</span>            <span class="ActionScriptComment">// we can compare the two paths.  We start from the left of side
</span>            <span class="ActionScriptComment">// of the path and start comparing.  When we either run out of
</span>            <span class="ActionScriptComment">// directories (one path is longer than the other), or we find
</span>            <span class="ActionScriptComment">// a directory that is different, we stop.  The remaining parts
</span>            <span class="ActionScriptComment">// of each path is then used to determine the relative path.  For
</span>            <span class="ActionScriptComment">// example, lets say we have:
</span>            <span class="ActionScriptComment">//    path we want to make relative: /a/b/c/d/e.txt
</span>            <span class="ActionScriptComment">//    path to use as base for relative: /a/b/f/
</span>            <span class="ActionScriptComment">//
</span>            <span class="ActionScriptComment">// This loop will start at the left, and remove directories
</span>            <span class="ActionScriptComment">// until we get a mismatch or run off the end of one of them.
</span>            <span class="ActionScriptComment">// In this example, the result will be:
</span>            <span class="ActionScriptComment">//    c/d/e.txt
</span>            <span class="ActionScriptComment">//    f
</span>            <span class="ActionScriptComment">//
</span>            <span class="ActionScriptComment">// For every part left over in the base path, we prepend a &quot;..&quot;
</span>            <span class="ActionScriptComment">// to the relative to get the final path:
</span>            <span class="ActionScriptComment">//   ../c/d/e.txt
</span>            <span class="ActionScriptReserved">while</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">thatParts</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">&gt;</span> 0<span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">thisParts</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">==</span> 0<span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptComment">// we matched all there is to match, we are done.
</span>                    <span class="ActionScriptComment">// This is the case where &quot;this&quot; object is a parent
</span>                    <span class="ActionScriptComment">// path of the given URI.  eg:
</span>                    <span class="ActionScriptComment">//   this.path = /a/b/                (thisParts)
</span>                    <span class="ActionScriptComment">//   base.path = /a/b/c/d/e/        (thatParts)
</span>                    <span class="ActionScriptReserved">break</span>;
                <span class="ActionScriptBracket/Brace">}</span>
        
                <span class="ActionScriptDefault_Text">thisPart</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">thisParts</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptDefault_Text">thatPart</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">thatParts</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span>;
        
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">compareStr</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">thisPart</span>, <span class="ActionScriptDefault_Text">thatPart</span>, <span class="ActionScriptDefault_Text">caseSensitive</span><span class="ActionScriptBracket/Brace">))</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">thisParts</span>.<span class="ActionScriptDefault_Text">shift</span><span class="ActionScriptBracket/Brace">()</span>;
                    <span class="ActionScriptDefault_Text">thatParts</span>.<span class="ActionScriptDefault_Text">shift</span><span class="ActionScriptBracket/Brace">()</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">else</span>
                    <span class="ActionScriptReserved">break</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        
            <span class="ActionScriptComment">// If there are any path info left from the base URI, that means
</span>            <span class="ActionScriptComment">// **this** object is above the given URI in the file tree.  For
</span>            <span class="ActionScriptComment">// each part left over in the given URI, we need to move up one
</span>            <span class="ActionScriptComment">// directory to get where we are.
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">dotdot</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;..&quot;</span>;
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">thatParts</span>.<span class="ActionScriptDefault_Text">length</span>; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">finalParts</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">dotdot</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        
            <span class="ActionScriptComment">// Append the parts of this URI to any dot-dot&apos;s we have
</span>            <span class="ActionScriptDefault_Text">finalParts</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">finalParts</span>.<span class="ActionScriptDefault_Text">concat</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">thisParts</span><span class="ActionScriptBracket/Brace">)</span>;
        
            <span class="ActionScriptComment">// Join the parts back into a path
</span>            <span class="ActionScriptDefault_Text">finalPath</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">joinPath</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">finalParts</span>, <span class="ActionScriptReserved">false</span> <span class="ActionScriptComment">/* not absolute */</span>, <span class="ActionScriptDefault_Text">isDir</span><span class="ActionScriptBracket/Brace">)</span>;
        
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">finalPath</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">==</span> 0<span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// The two URI&apos;s are exactly the same.  The proper relative
</span>                <span class="ActionScriptComment">// path is:
</span>                <span class="ActionScriptDefault_Text">finalPath</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;./&quot;</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        
            <span class="ActionScriptComment">// Set the parts of the URI, preserving the original query and
</span>            <span class="ActionScriptComment">// fragment parts.
</span>            <span class="ActionScriptDefault_Text">setParts</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;&quot;</span>, <span class="ActionScriptString">&quot;&quot;</span>, <span class="ActionScriptString">&quot;&quot;</span>, <span class="ActionScriptDefault_Text">finalPath</span>, <span class="ActionScriptDefault_Text">queryStr</span>, <span class="ActionScriptDefault_Text">fragmentStr</span><span class="ActionScriptBracket/Brace">)</span>;
        
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">true</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Given a string, convert it to a URI.  The string could be a
         * full URI that is improperly escaped, a malformed URI (e.g.
         * missing a protocol like &quot;www.something.com&quot;), a relative URI,
         * or any variation there of.
         * 
         * &lt;p&gt;The intention of this function is to take anything that a
         * user might manually enter as a URI/URL and try to determine what
         * they mean.  This function differs from the URI constructor in
         * that it makes some assumptions to make it easy to import user
         * entered URI data.&lt;/p&gt;
         * 
         * &lt;p&gt;This function is intended to be a helper function.
         * It is not all-knowning and will probably make mistakes
         * when attempting to parse a string of unknown origin.  If
         * your applicaiton is receiving input from the user, your
         * application should already have a good idea what the user
         * should  be entering, and your application should be
         * pre-processing the user&apos;s input to make sure it is well formed
         * before passing it to this function.&lt;/p&gt;
         * 
         * &lt;p&gt;It is assumed that the string given to this function is
         * something the user may have manually entered.  Given this,
         * the URI string is probably unescaped or improperly escaped.
         * This function will attempt to properly escape the URI by
         * using forceEscape().  The result is that a toString() call
         * on a URI that was created from unknownToURI() may not match
         * the input string due to the difference in escaping.&lt;/p&gt;
         *
         * @param unknown    a potental URI string that should be parsed
         * and loaded into this object.
         * @param defaultScheme    if it is determined that the passed string
         * looks like a URI, but it is missing the scheme part, this
         * string will be used as the missing scheme.
         * 
         * @return    true if the given string was successfully parsed into
         * a valid URI object, false otherwise.
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">unknownToURI</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">unknown</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>, <span class="ActionScriptDefault_Text">defaultScheme</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;http&quot;</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">Boolean</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">temp</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>;
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">unknown</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">==</span> 0<span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">initialize</span><span class="ActionScriptBracket/Brace">()</span>;
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">false</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">// Some users love the backslash key.  Fix it.
</span>            <span class="ActionScriptDefault_Text">unknown</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">unknown</span>.<span class="ActionScriptDefault_Text">replace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">/</span><span class="ActionScriptDefault_Text">\\</span><span class="ActionScriptOperator">/</span><span class="ActionScriptDefault_Text">g</span>, <span class="ActionScriptString">&quot;/&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">// Check for any obviously missing scheme.
</span>            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">unknown</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">&gt;=</span> 2<span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">temp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">unknown</span>.<span class="ActionScriptDefault_Text">substr</span><span class="ActionScriptBracket/Brace">(</span>0, 2<span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">temp</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&quot;//&quot;</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptDefault_Text">unknown</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">defaultScheme</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">&quot;:&quot;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">unknown</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">unknown</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">&gt;=</span> 3<span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">temp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">unknown</span>.<span class="ActionScriptDefault_Text">substr</span><span class="ActionScriptBracket/Brace">(</span>0, 3<span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">temp</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&quot;://&quot;</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptDefault_Text">unknown</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">defaultScheme</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">unknown</span>;
            <span class="ActionScriptBracket/Brace">}</span>

            <span class="ActionScriptComment">// Try parsing it as a normal URI
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">uri</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">URI</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">URI</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">unknown</span><span class="ActionScriptBracket/Brace">)</span>;
        
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">uri</span>.<span class="ActionScriptDefault_Text">isHierarchical</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">false</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">uri</span>.<span class="ActionScriptDefault_Text">scheme</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">UNKNOWN_SCHEME</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">initialize</span><span class="ActionScriptBracket/Brace">()</span>;
                    <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">false</span>;
                <span class="ActionScriptBracket/Brace">}</span>
        
                <span class="ActionScriptComment">// It&apos;s a non-hierarchical URI
</span>                <span class="ActionScriptDefault_Text">copyURI</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">uri</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">forceEscape</span><span class="ActionScriptBracket/Brace">()</span>;
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">true</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">((</span><span class="ActionScriptDefault_Text">uri</span>.<span class="ActionScriptDefault_Text">scheme</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptDefault_Text">UNKNOWN_SCHEME</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&amp;&amp;</span>
                <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">uri</span>.<span class="ActionScriptDefault_Text">scheme</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">&gt;</span> 0<span class="ActionScriptBracket/Brace">))</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">uri</span>.<span class="ActionScriptDefault_Text">authority</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">&gt;</span> 0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">||</span>
                    <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">uri</span>.<span class="ActionScriptDefault_Text">scheme</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&quot;file&quot;</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptComment">// file://... URI
</span>                    <span class="ActionScriptDefault_Text">copyURI</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">uri</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">forceEscape</span><span class="ActionScriptBracket/Brace">()</span>;  <span class="ActionScriptComment">// ensure proper escaping
</span>                    <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">true</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">uri</span>.<span class="ActionScriptDefault_Text">authority</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">==</span> 0 <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">uri</span>.<span class="ActionScriptDefault_Text">path</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">==</span> 0<span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptComment">// It&apos;s is an incomplete URI (eg &quot;http://&quot;)
</span>                    
                    <span class="ActionScriptDefault_Text">setParts</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">uri</span>.<span class="ActionScriptDefault_Text">scheme</span>, <span class="ActionScriptString">&quot;&quot;</span>, <span class="ActionScriptString">&quot;&quot;</span>, <span class="ActionScriptString">&quot;&quot;</span>, <span class="ActionScriptString">&quot;&quot;</span>, <span class="ActionScriptString">&quot;&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">false</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// Possible relative URI.  We can only detect relative URI&apos;s
</span>                <span class="ActionScriptComment">// that start with &quot;.&quot; or &quot;..&quot;.  If it starts with something
</span>                <span class="ActionScriptComment">// else, the parsing is ambiguous.
</span>                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">path</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">uri</span>.<span class="ActionScriptDefault_Text">path</span>;
        
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">path</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&quot;..&quot;</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">path</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&quot;.&quot;</span> <span class="ActionScriptOperator">||</span> 
                    <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">path</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">&gt;=</span> 3 <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">path</span>.<span class="ActionScriptDefault_Text">substr</span><span class="ActionScriptBracket/Brace">(</span>0, 3<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&quot;../&quot;</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">||</span>
                    <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">path</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">&gt;=</span> 2 <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">path</span>.<span class="ActionScriptDefault_Text">substr</span><span class="ActionScriptBracket/Brace">(</span>0, 2<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&quot;./&quot;</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptComment">// This is a relative URI.
</span>                    <span class="ActionScriptDefault_Text">copyURI</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">uri</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">forceEscape</span><span class="ActionScriptBracket/Brace">()</span>;
                    <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">true</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
        
            <span class="ActionScriptComment">// Ok, it looks like we are just a normal URI missing the scheme.  Tack
</span>            <span class="ActionScriptComment">// on the scheme.
</span>            <span class="ActionScriptDefault_Text">uri</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">URI</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">defaultScheme</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">&quot;://&quot;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">unknown</span><span class="ActionScriptBracket/Brace">)</span>;
        
            <span class="ActionScriptComment">// Check to see if we are good now
</span>            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">uri</span>.<span class="ActionScriptDefault_Text">scheme</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">&gt;</span> 0 <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">uri</span>.<span class="ActionScriptDefault_Text">authority</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">&gt;</span> 0<span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// It was just missing the scheme.
</span>                <span class="ActionScriptDefault_Text">copyURI</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">uri</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">forceEscape</span><span class="ActionScriptBracket/Brace">()</span>;  <span class="ActionScriptComment">// Make sure we are properly encoded.
</span>                <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">true</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        
            <span class="ActionScriptComment">// don&apos;t know what this is
</span>            <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">initialize</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">false</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
    <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptComment">// end URI class
</span><span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptComment">// end package</span></pre></body>
</html>
