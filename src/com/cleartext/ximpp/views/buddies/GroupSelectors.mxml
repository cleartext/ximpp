<?xml version="1.0" encoding="utf-8"?>
<mx:VBox xmlns:mx="http://www.adobe.com/2006/mxml"
	creationComplete="init()"
	xmlns:common="com.cleartext.ximpp.views.common.*"
	width="100%"
	height="100%">
	<mx:Script>
		<![CDATA[
			import com.cleartext.ximpp.assets.Constants;
			import mx.events.CollectionEvent;
			import mx.core.UIComponent;
			import com.cleartext.ximpp.events.PopUpEvent;
			import org.swizframework.Swiz;
			import com.cleartext.ximpp.views.common.SideButton;
			import mx.controls.Button;
			import com.cleartext.ximpp.events.BuddyModelEvent;
			import com.cleartext.ximpp.models.BuddyModel;
			
			[Autowire]
			[Bindable]
			public var buddies:BuddyModel;
			
			[Autowire (bean="xmpp", property="connected")]
			[Bindable]
			public var connected:Boolean;
			
			private var groupButtons:Dictionary = new Dictionary();
			
			private function init():void
			{
				buddies.groups.addEventListener(CollectionEvent.COLLECTION_CHANGE, groupListChanged);
				groupListChanged(null);
			}
			
			public function groupListChanged(event:CollectionEvent):void
			{
				var button:SideButton;
				
				var buttonsToRemove:Dictionary = new Dictionary();
				
				for each(button in groupButtons)
					buttonsToRemove[button.text] = button;
				
				var childIndex:int = 3;
				for each(var group:String in buddies.groups)
				{
					button = groupButtons[group] as SideButton;
					
					if(!button)
					{
						button = new SideButton();
						groupButtons[group] = button;
						button.text = group;
						button.icon = Constants.DefaultGroupIcon;
						button.addEventListener(MouseEvent.CLICK, clickHandler);
						addChildAt(button, childIndex);
					}
					else
					{
						setChildIndex(button, childIndex);
						delete buttonsToRemove[button.text];
					}
					childIndex++;
				}

				for each(button in buttonsToRemove)
				{
					removeChild(button);
					delete groupButtons[button.text];
				}
			}
			
			private function clickHandler(event:MouseEvent):void
			{
				buddies.groupName = event.target.text;
				invalidateProperties();
			}
			
			override protected function commitProperties():void
			{
				super.commitProperties();
				
				for each(var child:UIComponent in getChildren())
				{
					var sb:SideButton = child as SideButton;
					if(sb)
						sb.selected = sb.text==buddies.groupName;
				}
			}

		]]>
	</mx:Script>
	
	<common:SideButton text="{BuddyModel.ALL_BUDDIES_GROUP}" click="clickHandler(event)" icon="{Constants.AllBuddies}" showEditButton="false"/>

	<common:SideButton text="{BuddyModel.GATEWAY_GROUP}" click="clickHandler(event)" icon="{Constants.Gateways}" showEditButton="false"/>

	<common:SideButton text="{BuddyModel.UNASIGNED}" click="clickHandler(event)" icon="{Constants.NoGroup}" showEditButton="false"/>

	<mx:Button
		click="Swiz.dispatchEvent(new PopUpEvent(PopUpEvent.ADD_BUDDY_WINDOW))"
		toolTip="{(connected) ? 'add buddy' : 'go online to add a buddy'}"
		width="32" height="32"
		enabled="{connected}"
		skin="{null}"
		upIcon="{Constants.AddBuddyUp}"
		overIcon="{Constants.AddBuddyOver}"
		downIcon="{Constants.AddBuddyOver}"
		disabledIcon="{Constants.AddBuddyOver}"
		/>

	<mx:Button
		click="Swiz.dispatchEvent(new PopUpEvent(PopUpEvent.ADD_GATEWAY_WINDOW))"
		toolTip="{(connected) ? 'add gateway' : 'go online to add a gateway'}"
		width="32" height="32"
		enabled="{connected}"
		skin="{null}"
		upIcon="{Constants.AddGatewayUp}"
		overIcon="{Constants.AddGatewayOver}"
		downIcon="{Constants.AddGatewayOver}"
		disabledIcon="{Constants.AddGatewayOver}"
		/>

	<mx:Button
		click="Swiz.dispatchEvent(new PopUpEvent(PopUpEvent.ADD_GROUP_WINDOW))"
		toolTip="{(connected) ? 'add group' : 'go online to add a group'}"
		width="32" height="32"
		enabled="{connected}"
		skin="{null}"
		upIcon="{Constants.Add}"
		overIcon="{Constants.AddOver}"
		downIcon="{Constants.AddOver}"
		disabledIcon="{Constants.AddOver}"
		/>

</mx:VBox>
